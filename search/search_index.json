{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#opendtu","title":"OpenDTU","text":"<p>Open Source software to talk to Hoymiles solar inverters. It is an alternative to their DTUs<sup>1</sup> which sync everthing into the s-Miles cloud.</p>"},{"location":"#remarkable-features","title":"Remarkable features","text":"<ul> <li>Read live data from inverter</li> <li>Show inverters internal event log</li> <li>Show inverter information like firmware version, firmware build date, hardware revision and hardware version</li> <li>Show and set the current inverter limit</li> <li>Show the current grid profile settings</li> <li>Function to turn the inverter off and on</li> <li>Supports up to 10 inverters</li> <li>MQTT support (with TLS)</li> <li>Home Assistant MQTT Auto Discovery support</li> <li>Nice and fancy WebApp with visualization of current data</li> <li>Firmware upgrade using the web UI</li> <li>Time zone support</li> <li>Ethernet support</li> <li>Prometheus API endpoint (/api/prometheus/metrics)</li> <li>English, german and french web interface</li> <li>Displays (SSD1306, SH1106, PCD8544)</li> <li>Status LEDs</li> <li>Configuration management (export / import configurations)</li> <li>Dark Theme</li> </ul>"},{"location":"#features-for-developers","title":"Features for developers","text":"<ul> <li> <p>The microcontroller part</p> <ul> <li>Build with Arduino PlatformIO Framework for the ESP32</li> <li>Uses a fork of ESPAsyncWebserver and espMqttClient</li> </ul> </li> <li> <p>The WebApp part</p> <ul> <li>Build with Vue.js and Bootstrap</li> <li>Source is written in TypeScript</li> </ul> </li> </ul>"},{"location":"#background","title":"Background","text":"<p>This project was started from this discussion (Mikrocontroller.net). It was the goal to replace the original Hoymiles DTU (Telemetry Gateway) with their cloud access. With a lot of reverse engineering the Hoymiles protocol was decrypted and analyzed.</p>"},{"location":"#support","title":"Support","text":"<p>For support using openHASP you can find us on Github or Discord:</p> <p> Github Discussions  Discord Chat</p>"},{"location":"#donate","title":"Donate","text":"<p>The firmware is opensource and free to use!</p> <p>If you like this project you can show your appreciation by making a small donation. This will help with offsetting the cost of the different hardware devices we support.</p> <p></p> <ol> <li> <p>Data Transfer Unit\u00a0\u21a9</p> </li> </ol>"},{"location":"license/","title":"GNU General Public License","text":"<p>Version 2, June 1991 Copyright \u00a9 1989, 1991 Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</p> <p>Everyone is permitted to copy and distribute verbatim copies of this license document, but changing it is not allowed.</p>"},{"location":"license/#preamble","title":"Preamble","text":"<p>The licenses for most software are designed to take away your freedom to share and change it.  By contrast, the GNU General Public License is intended to guarantee your freedom to share and change free software--to make sure the software is free for all its users.  This General Public License applies to most of the Free Software Foundation's software and to any other program whose authors commit to using it.  (Some other Free Software Foundation software is covered by the GNU Lesser General Public License instead.)  You can apply it to your programs, too.</p> <p>When we speak of free software, we are referring to freedom, not price.  Our General Public Licenses are designed to make sure that you have the freedom to distribute copies of free software (and charge for this service if you wish), that you receive source code or can get it if you want it, that you can change the software or use pieces of it in new free programs; and that you know you can do these things.</p> <p>To protect your rights, we need to make restrictions that forbid anyone to deny you these rights or to ask you to surrender the rights. These restrictions translate to certain responsibilities for you if you distribute copies of the software, or if you modify it.</p> <p>For example, if you distribute copies of such a program, whether gratis or for a fee, you must give the recipients all the rights that you have.  You must make sure that they, too, receive or can get the source code.  And you must show them these terms so they know their rights.</p> <p>We protect your rights with two steps: (1) copyright the software, and (2) offer you this license which gives you legal permission to copy, distribute and/or modify the software.</p> <p>Also, for each author's protection and ours, we want to make certain that everyone understands that there is no warranty for this free software.  If the software is modified by someone else and passed on, we want its recipients to know that what they have is not the original, so that any problems introduced by others will not reflect on the original authors' reputations.</p> <p>Finally, any free program is threatened constantly by software patents.  We wish to avoid the danger that redistributors of a free program will individually obtain patent licenses, in effect making the program proprietary.  To prevent this, we have made it clear that any patent must be licensed for everyone's free use or not licensed at all.</p> <p>The precise terms and conditions for copying, distribution and modification follow.</p>"},{"location":"license/#terms-and-conditions-for-copying-distribution-and-modification","title":"TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION","text":"<p>0. This License applies to any program or other work which contains a notice placed by the copyright holder saying it may be distributed under the terms of this General Public License.  The \u201cProgram\u201d, below, refers to any such program or work, and a \u201cwork based on the Program\u201d means either the Program or any derivative work under copyright law: that is to say, a work containing the Program or a portion of it, either verbatim or with modifications and/or translated into another language.  (Hereinafter, translation is included without limitation in the term \u201cmodification\u201d.)  Each licensee is addressed as \u201cyou\u201d.</p> <p>Activities other than copying, distribution and modification are not covered by this License; they are outside its scope.  The act of running the Program is not restricted, and the output from the Program is covered only if its contents constitute a work based on the Program (independent of having been made by running the Program). Whether that is true depends on what the Program does.</p> <p>1. You may copy and distribute verbatim copies of the Program's source code as you receive it, in any medium, provided that you conspicuously and appropriately publish on each copy an appropriate copyright notice and disclaimer of warranty; keep intact all the notices that refer to this License and to the absence of any warranty; and give any other recipients of the Program a copy of this License along with the Program.</p> <p>You may charge a fee for the physical act of transferring a copy, and you may at your option offer warranty protection in exchange for a fee.</p> <p>2. You may modify your copy or copies of the Program or any portion of it, thus forming a work based on the Program, and copy and distribute such modifications or work under the terms of Section 1 above, provided that you also meet all of these conditions:</p> <ul> <li>a) You must cause the modified files to carry prominent notices stating that you changed the files and the date of any change.</li> <li>b) You must cause any work that you distribute or publish, that in whole or in part contains or is derived from the Program or any part thereof, to be licensed as a whole at no charge to all third parties under the terms of this License.</li> <li>c) If the modified program normally reads commands interactively when run, you must cause it, when started running for such interactive use in the most ordinary way, to print or display an announcement including an appropriate copyright notice and a notice that there is no warranty (or else, saying that you provide a warranty) and that users may redistribute the program under these conditions, and telling the user how to view a copy of this License.  (Exception: if the Program itself is interactive but does not normally print such an announcement, your work based on the Program is not required to print an announcement.)</li> </ul> <p>These requirements apply to the modified work as a whole.  If identifiable sections of that work are not derived from the Program, and can be reasonably considered independent and separate works in themselves, then this License, and its terms, do not apply to those sections when you distribute them as separate works.  But when you distribute the same sections as part of a whole which is a work based on the Program, the distribution of the whole must be on the terms of this License, whose permissions for other licensees extend to the entire whole, and thus to each and every part regardless of who wrote it.</p> <p>Thus, it is not the intent of this section to claim rights or contest your rights to work written entirely by you; rather, the intent is to exercise the right to control the distribution of derivative or collective works based on the Program.</p> <p>In addition, mere aggregation of another work not based on the Program with the Program (or with a work based on the Program) on a volume of a storage or distribution medium does not bring the other work under the scope of this License.</p> <p>3. You may copy and distribute the Program (or a work based on it, under Section 2) in object code or executable form under the terms of Sections 1 and 2 above provided that you also do one of the following:</p> <ul> <li>a) Accompany it with the complete corresponding machine-readable source code, which must be distributed under the terms of Sections 1 and 2 above on a medium customarily used for software interchange; or,</li> <li>b) Accompany it with a written offer, valid for at least three years, to give any third party, for a charge no more than your cost of physically performing source distribution, a complete machine-readable copy of the corresponding source code, to be distributed under the terms of Sections 1 and 2 above on a medium customarily used for software interchange; or,</li> <li>c) Accompany it with the information you received as to the offer to distribute corresponding source code.  (This alternative is allowed only for noncommercial distribution and only if you received the program in object code or executable form with such an offer, in accord with Subsection b above.)</li> </ul> <p>The source code for a work means the preferred form of the work for making modifications to it.  For an executable work, complete source code means all the source code for all modules it contains, plus any associated interface definition files, plus the scripts used to control compilation and installation of the executable.  However, as a special exception, the source code distributed need not include anything that is normally distributed (in either source or binary form) with the major components (compiler, kernel, and so on) of the operating system on which the executable runs, unless that component itself accompanies the executable.</p> <p>If distribution of executable or object code is made by offering access to copy from a designated place, then offering equivalent access to copy the source code from the same place counts as distribution of the source code, even though third parties are not compelled to copy the source along with the object code.</p> <p>4. You may not copy, modify, sublicense, or distribute the Program except as expressly provided under this License.  Any attempt otherwise to copy, modify, sublicense or distribute the Program is void, and will automatically terminate your rights under this License. However, parties who have received copies, or rights, from you under this License will not have their licenses terminated so long as such parties remain in full compliance.</p> <p>5. You are not required to accept this License, since you have not signed it.  However, nothing else grants you permission to modify or distribute the Program or its derivative works.  These actions are prohibited by law if you do not accept this License.  Therefore, by modifying or distributing the Program (or any work based on the Program), you indicate your acceptance of this License to do so, and all its terms and conditions for copying, distributing or modifying the Program or works based on it.</p> <p>6. Each time you redistribute the Program (or any work based on the Program), the recipient automatically receives a license from the original licensor to copy, distribute or modify the Program subject to these terms and conditions.  You may not impose any further restrictions on the recipients' exercise of the rights granted herein. You are not responsible for enforcing compliance by third parties to this License.</p> <p>7. If, as a consequence of a court judgment or allegation of patent infringement or for any other reason (not limited to patent issues), conditions are imposed on you (whether by court order, agreement or otherwise) that contradict the conditions of this License, they do not excuse you from the conditions of this License.  If you cannot distribute so as to satisfy simultaneously your obligations under this License and any other pertinent obligations, then as a consequence you may not distribute the Program at all.  For example, if a patent license would not permit royalty-free redistribution of the Program by all those who receive copies directly or indirectly through you, then the only way you could satisfy both it and this License would be to refrain entirely from distribution of the Program.</p> <p>If any portion of this section is held invalid or unenforceable under any particular circumstance, the balance of the section is intended to apply and the section as a whole is intended to apply in other circumstances.</p> <p>It is not the purpose of this section to induce you to infringe any patents or other property right claims or to contest validity of any such claims; this section has the sole purpose of protecting the integrity of the free software distribution system, which is implemented by public license practices.  Many people have made generous contributions to the wide range of software distributed through that system in reliance on consistent application of that system; it is up to the author/donor to decide if he or she is willing to distribute software through any other system and a licensee cannot impose that choice.</p> <p>This section is intended to make thoroughly clear what is believed to be a consequence of the rest of this License.</p> <p>8. If the distribution and/or use of the Program is restricted in certain countries either by patents or by copyrighted interfaces, the original copyright holder who places the Program under this License may add an explicit geographical distribution limitation excluding those countries, so that distribution is permitted only in or among countries not thus excluded.  In such case, this License incorporates the limitation as if written in the body of this License.</p> <p>9. The Free Software Foundation may publish revised and/or new versions of the General Public License from time to time.  Such new versions will be similar in spirit to the present version, but may differ in detail to address new problems or concerns.</p> <p>Each version is given a distinguishing version number.  If the Program specifies a version number of this License which applies to it and \u201cany later version\u201d, you have the option of following the terms and conditions either of that version or of any later version published by the Free Software Foundation.  If the Program does not specify a version number of this License, you may choose any version ever published by the Free Software Foundation.</p> <p>10. If you wish to incorporate parts of the Program into other free programs whose distribution conditions are different, write to the author to ask for permission.  For software which is copyrighted by the Free Software Foundation, write to the Free Software Foundation; we sometimes make exceptions for this.  Our decision will be guided by the two goals of preserving the free status of all derivatives of our free software and of promoting the sharing and reuse of software generally.</p>"},{"location":"license/#no-warranty","title":"NO WARRANTY","text":"<p>11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM \u201cAS IS\u201d WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR OR CORRECTION.</p> <p>12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</p> <p>END OF TERMS AND CONDITIONS</p>"},{"location":"license/#how-to-apply-these-terms-to-your-new-programs","title":"How to Apply These Terms to Your New Programs","text":"<p>If you develop a new program, and you want it to be of the greatest possible use to the public, the best way to achieve this is to make it free software which everyone can redistribute and change under these terms.</p> <p>To do so, attach the following notices to the program.  It is safest to attach them to the start of each source file to most effectively convey the exclusion of warranty; and each file should have at least the \u201ccopyright\u201d line and a pointer to where the full notice is found.</p> <pre><code>&lt;one line to give the program's name and a brief idea of what it does.&gt;\nCopyright (C) &lt;year&gt;  &lt;name of author&gt;\n\nThis program is free software; you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation; either version 2 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License along\nwith this program; if not, write to the Free Software Foundation, Inc.,\n51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.\n</code></pre> <p>Also add information on how to contact you by electronic and paper mail.</p> <p>If the program is interactive, make it output a short notice like this when it starts in an interactive mode:</p> <pre><code>Gnomovision version 69, Copyright (C) year name of author\nGnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.\nThis is free software, and you are welcome to redistribute it\nunder certain conditions; type `show c' for details.\n</code></pre> <p>The hypothetical commands <code>show w</code> and <code>show c</code> should show the appropriate parts of the General Public License.  Of course, the commands you use may be called something other than <code>show w</code> and <code>show c</code>; they could even be mouse-clicks or menu items--whatever suits your program.</p> <p>You should also get your employer (if you work as a programmer) or your school, if any, to sign a \u201ccopyright disclaimer\u201d for the program, if necessary.  Here is a sample; alter the names:</p> <pre><code>Yoyodyne, Inc., hereby disclaims all copyright interest in the program\n`Gnomovision' (which makes passes at compilers) written by James Hacker.\n\n&lt;signature of Ty Coon&gt;, 1 April 1989\nTy Coon, President of Vice\n</code></pre> <p>This General Public License does not permit incorporating your program into proprietary programs.  If your program is a subroutine library, you may consider it more useful to permit linking proprietary applications with the library.  If this is what you want to do, use the GNU Lesser General Public License instead of this License.</p>"},{"location":"troubleshooting/","title":"Troubleshooting","text":"<ul> <li>First: When there is no light on the solar panels, the inverter completely turns off and does not answer to OpenDTU! So if you assembled your OpenDTU in the evening, wait until tomorrow.</li> <li>When there is no data received from the inverter(s) - try to reduce the distance between the openDTU and the inverter (e.g. move it to the window towards the roof)</li> <li>Under Settings -&gt; DTU Settings you can increase the transmit power \"PA level\". Default is \"minimum\".</li> <li>The NRF24L01+ needs relatively much current. With bad power supply (and especially bad cables!) a 10 \u00b5F capacitor soldered directly to the NRF24L01+ board connector brings more stability (pin 1+2 are the power supply). Note the polarity of the capacitor\u2026</li> <li>You can try to use an USB power supply with 1 A or more instead of connecting the ESP32 to the computer.</li> <li>Try a different USB cable. Once again, a stable power source is important. Some USB cables are made of much plastic and very little copper inside.</li> <li>Double check that you have a radio module NRF24L01+ with a plus sign at the end. NRF24L01 module without the plus are not compatible with this project.</li> <li>There is no possibility of auto-discovering the inverters. Double check you have entered the serial numbers of the inverters correctly.</li> <li>OpenDTU needs access to a working NTP server to get the current date &amp; time.</li> <li>If your problem persists, check the  Issues on Github. Please inspect not only the open issues, also the closed issues contain useful information.</li> <li>Another source of information are the Discussions</li> <li>When flashing with VSCode Plattform.IO fails and also with ESPRESSIF tool a demo bin file cannot be flashed to the ESP32 with error message \"A fatal error occurred: MD5 of file does not match data in flash!\" than un-wire/unconnect ESP32 from the NRF24L01+ board. Try to flash again and rewire afterwards.</li> <li>Make sure to connect one inverter only to one DTU (Original, Ahoy, OpenDTU doesn't make a difference). If you query a inverter by multiple DTUs you will get strange peaks in your values.</li> </ul>"},{"location":"3rd_party/blinkyparts/","title":"OpenDTU Breakoutboard","text":"<p>We sat down together and designed a PCB. This is 100% compatible with openDTU and has space for all extensions such as display and LEDs. You can find the PCB design here: https://github.com/marove2000/openDTU_BreakoutBoard</p> <p>A ready to solder kit can be found here: https://shop.blinkyparts.com/en/OpenDTU-Your-evaluation-for-your-balcony-solar-system/blink237542</p> <p> </p>"},{"location":"3rd_party/cases/","title":"Available cases","text":"<ul> <li>Open DTU box</li> <li>S\u00f3l: OpenDTU (ESP32 / NRF24L01+) case</li> <li>Complete solderless case for Olimex ESP32-POE-ISO</li> <li>DTU Case V1 complete solderless case for ESP32 and NRF24L01+ or EBYTE E01-ML01DP5</li> <li>Case for OpenDTU with integrated OLED Display</li> <li>OpenDTU PCB box for the wider board</li> <li>ESP32 Ahoy openDTU PCB housing</li> <li>Case for openDTU Ahoy Breakout Board (ESP32 and NRF24L01)</li> </ul>"},{"location":"3rd_party/opendtu_fusion/","title":"OpenDTU Fusion","text":"<p>This board was developed by @markusdd and the help of the OpenDTU/ahoy Discord community. It integrates all the components that are necessary to run OpenDTU on 5.5cm x 5.5cm, namely a ESP32-S3-WROOM-1U module, and the complete RF paths for NRF24 (HM series) and CMT2300A (HMS/HMT series) communications. So this PCB can interface with all supported inverters and uses the most modern ESP32-S3 chip.</p> <p>Generic builds for the esp32-s3-usb are available in the OpenDTU Release section. The board specific documentation is available over at the OpenDTUFusion Documentation repository: https://github.com/markusdd/OpenDTUFusionDocs</p> <p>For info on where to buy this board refer to the Where to get section.</p> <p>OpenDTU also ships a OpenDTUFusion specific pinout JSON in it's repository which can be found here: https://github.com/tbnobody/OpenDTU/blob/master/docs/DeviceProfiles/opendtu_fusion.json</p>"},{"location":"3rd_party/pcb/","title":"Available layouts for printed circuit boards","text":"<ul> <li>BreakoutBoard - sample printed circuit board for OpenDTU and Ahoy</li> <li>Board for OpenDTU with Display</li> <li>OpenDTU PCB mit Display</li> <li>PCB for OpenDTU in Cable Branchbox</li> <li>OpenDTU-BreakoutBoard &amp; Case for Wallmounting</li> </ul>"},{"location":"3rd_party/related/","title":"Related Projects","text":"<ul> <li>Ahoy</li> <li>DTU Simulator</li> <li>OpenDTU extended to talk to Victrons MPPT battery chargers (Ve.Direct)</li> <li>Dynamic Limit Management</li> <li>ioBroker.opendtu</li> <li>OpenDTU-onBattery</li> </ul>"},{"location":"firmware/","title":"Getting Started","text":""},{"location":"firmware/compile_cli/","title":"Compile on the command line with PlatformIO Core","text":"<ul> <li>Install PlatformIO Core</li> <li>Clone this repository (you really have to clone it, don't just download the ZIP file. During the build process the git hash gets embedded into the firmware. If you download the ZIP file a build error will occur)</li> <li>Adjust the COM port in the file \"platformio_override.ini\". It occurs twice:<ul> <li>upload_port</li> <li>monitor_port</li> </ul> </li> <li>build: <code>platformio run -e generic</code></li> <li>upload to esp module: <code>platformio run -e generic -t upload</code></li> <li>other options:<ul> <li>clean the sources:  <code>platformio run -e generic -t clean</code></li> <li>erase flash: <code>platformio run -e generic -t erase</code></li> </ul> </li> </ul>"},{"location":"firmware/compile_vscode/","title":"Compile with Visual Studio Code","text":"<ul> <li>Install Visual Studio Code (from now named \"vscode\")</li> <li>In Visual Studio Code, install the PlatformIO Extension</li> <li>Install git and enable git in vscode - git download - Instructions</li> <li>Clone this repository (you really have to clone it, don't just download the ZIP file. During the build process the git hash gets embedded into the firmware. If you download the ZIP file a build error will occur): Inside vscode open the command palette by pressing Ctrl+Shift+P. Enter <code>git clone</code>, add the repository-URL <code>https://github.com/tbnobody/OpenDTU</code>. Next you have to choose (or create) a target directory.</li> <li>In vscode, choose File --&gt; Open Folder and select the previously downloaded source code. (You have to select the folder which contains the \"platformio.ini\" and \"platformio_override.ini\" file)</li> <li>Adjust the COM port in the file \"platformio_override.ini\" for your USB-to-serial-converter. It occurs twice:<ul> <li>upload_port</li> <li>monitor_port</li> </ul> </li> <li>Select the arrow button in the blue bottom status bar (PlatformIO: Upload) to compile and upload the firmware. During the compilation, all required libraries are downloaded automatically.</li> <li>Under Linux, if the upload fails with error messages \"Could not open /dev/ttyUSB0, the port doesn't exist\", you can check via <code>ls -la /dev/tty*</code> to which group your port belongs to, and then add your user this group via <code>sudo adduser &lt;yourusername&gt; dialout</code> (if you are using <code>arch-linux</code> use: <code>sudo gpasswd -a &lt;yourusername&gt; uucp</code>, this method requires a logout/login of the affected user).</li> <li>There are two videos showing these steps:<ul> <li>Git Clone and compilation</li> <li>Full installation and compilation</li> </ul> </li> </ul>"},{"location":"firmware/compile_webapp/","title":"Compile WebApp","text":""},{"location":"firmware/compile_webapp/#general-information","title":"General information","text":"<p>The WebApp works completly independent from the C/C++ firmware. When compiling the Firmware the pre-compiled WebApp will be embedded into the <code>.bin</code> file. The communication between the frontend and the ESP is just done using the Web API.</p> <p>If you've changed some of the WebApp files you have to recompile the WebApp. There is also a dev server which hosts the frontend at your local computer and allows a easy development. It will forward all the requests to the backend automatically to your ESP. That means you can develop the webinterface without flashing the ESP (if the WebAPI stays the same).</p>"},{"location":"firmware/compile_webapp/#install-prerequisits","title":"Install prerequisits","text":"<p>You need to install NodeJS LTS to be able to work with the WebApp.</p>"},{"location":"firmware/compile_webapp/#building-the-webapp","title":"Building the WebApp","text":"<p>The WebApp will be build using <code>yarn</code>. FIrst of all you have to install all the dependencies. Afterwards the app will be build. Start a Terminal of your choice and enter the following commands:</p> <pre><code>cd webapp\nyarn install\nyarn build\n</code></pre> <p>The generated WebApp will be placed in the <code>webapp_dist</code> directory from where it gets included by PlatformIO.</p>"},{"location":"firmware/compile_webapp/#starting-the-development-server","title":"Starting the Development Server","text":"<p>First of all, create a file called <code>vite.user.ts</code> in the <code>webappp</code> directory with the following content:</p> <pre><code>export const proxy_target = '192.168.20.110'\n</code></pre> <p>Replace the IP with the IP of your ESP.</p> <p>To start the development server execute the following commands:</p> <pre><code>yarn dev\n</code></pre>"},{"location":"firmware/compile_webapp/#lint-with-eslint","title":"Lint with ESLint","text":"<pre><code>yarn lint\n</code></pre>"},{"location":"firmware/device_profiles/","title":"Device Profiles","text":"<p>It is possible to change hardware settings like pin assignments or ethernet support using a json file. The json file can be uploaded using the configuration management in the web interface. Just select \"Pin Mapping (pin_mapping.json)\" in the recovery section.</p> <p>When the file is uploaded the ESP performs a reboot. This is required as the pin settings could have changed within the file. By default all the pin assignments are used as compiled into the firmware.</p> <p>To change the device profile, navigate to the \"Device Manager\" and selected the appropriate profile. You can see the current (Active) and the new (Selected) in assignment in the table below the combobox.</p>"},{"location":"firmware/device_profiles/#structure-of-the-json-file","title":"Structure of the json file","text":"<pre><code>[\n    {\n        \"name\": \"Generic NodeMCU 38 pin\",\n        \"nrf24\": {\n            \"miso\": 19,\n            \"mosi\": 23,\n            \"clk\": 18,\n            \"irq\": 16,\n            \"en\": 4,\n            \"cs\": 5\n        },\n        \"eth\": {\n            \"enabled\": false,\n            \"phy_addr\": -1,\n            \"power\": -1,\n            \"mdc\": -1,\n            \"mdio\": -1,\n            \"type\": -1,\n            \"clk_mode\": -1\n        }\n    },\n    {\n        \"name\": \"Generic NodeMCU 38 pin with SSD1306\",\n        \"nrf24\": {\n            \"miso\": 19,\n            \"mosi\": 23,\n            \"clk\": 18,\n            \"irq\": 16,\n            \"en\": 4,\n            \"cs\": 5\n        },\n        \"eth\": {\n            \"enabled\": false,\n            \"phy_addr\": -1,\n            \"power\": -1,\n            \"mdc\": -1,\n            \"mdio\": -1,\n            \"type\": -1,\n            \"clk_mode\": -1\n        },\n        \"display\": {\n            \"type\": 2,\n            \"data\": 21,\n            \"clk\": 22\n        }\n    },\n    {\n        \"name\": \"Olimex ESP32-POE\",\n        \"links\": [\n            {\"name\": \"Datasheet\", \"url\": \"https://www.olimex.com/Products/IoT/ESP32/ESP32-POE/open-source-hardware\"}\n        ],\n        \"nrf24\": {\n            \"miso\": 15,\n            \"mosi\": 2,\n            \"clk\": 14,\n            \"irq\": 13,\n            \"en\": 16,\n            \"cs\": 5\n        },\n        \"eth\": {\n            \"enabled\": true,\n            \"phy_addr\": 0,\n            \"power\": 12,\n            \"mdc\": 23,\n            \"mdio\": 18,\n            \"type\": 0,\n            \"clk_mode\": 3\n        }\n    }\n]\n</code></pre> <p>The json file can contain multiple profiles. Each profile requires a name and different parameters. If one parameter is not set, the default value, as compiled into the firmware is used. The example above shows all the currently supported values. Others may follow. Sample files for some boards can be found here. This means you can just flash the generic bin file and upload the json file. Then you select your board and everything works hopyfully as expected.</p>"},{"location":"firmware/device_profiles/#implemented-configuration-values","title":"Implemented configuration values","text":"Parameter Data Type Description name string Unique name of the profile (max 63 characters) links array Must contain a object with the properties name and url. For each object a button is shown in the Device-Manager nrf24.miso number MISO Pin nrf24.mosi number MOSI Pin nrf24.clk number Clock Pin nrf24.irq number Interrupt Pin nrf24.en number Enable Pin nrf24.cs number Chip Select Pin cmt.sdio number SDIO Pin cmt.clk number CLK Pin cmt.cs number CS Pin cmt.fcs number FCS Pin cmt.gpio2 number GPIO2 Pin (optional) cmt.gpio3 number GPIO3 Pin (optional) eth.enabled boolean Enable/Disable the ethernet stack eth.phy_addr number Unique PHY addr eth.power number Power Pin (if available). Use -1 for not assigned pins. eth.mdc number Serial Management Interface MDC Pin. Use -1 for not assigned pins. eth.mdio number Serial Management Interface MDIO Pin. Use -1 for not assigned pins. eth.type number Possible values:<ul><li>0 = ETH_PHY_LAN8720</li><li>1 = ETH_PHY_TLK110</li><li>2 = ETH_PHY_RTL8201</li><li>3 = ETH_PHY_DP83848</li><li>4 = ETH_PHY_DM9051</li><li>5 = ETH_PHY_KSZ8041</li><li>6 = ETH_PHY_KSZ8081</li></ul> eth.clk_mode number Possible values:<ul><li>0 = ETH_CLOCK_GPIO0_IN</li><li>1 = ETH_CLOCK_GPIO0_OUT</li><li>2 = ETH_CLOCK_GPIO16_OUT</li><li>3 = ETH_CLOCK_GPIO17_OUT</li></ul> display.type number Specify type of display. Possible values:<ul><li>0 = None (default)</li><li>1 = PCD8544</li><li>2 = SSD1306</li><li>3 = SH1106</li><li>4 = SSD1309</li></ul> display.data number Data Pin (e.g. SDA for i2c displays) required for all displays. Use 255 for not assigned pins. display.clk number Clock Pin (e.g. SCL for i2c displays) required for SSD1306 and SH1106. Use 255 for not assigned pins. display.cs number Chip Select Pin required for PCD8544. Use 255 for not assigned pins. display.reset number Reset Pin required for PCD8544, optional for all other displays. Use 255 for not assigned pins. led.led0 number LED pin for network indication. <ul><li>Blinking = WLAN connected but NTP &amp; MQTT (if enabled) disconnected.</li><li>On = WLAN, NTP, MQTT connected.</li><li>Off = Network not connected</li></ul> led.led1 number LED pin for inverter indication. <ul><li>On = All inverters reachable &amp; producing.</li><li>Blinking = All inverters reachable but not producing.</li><li>Off = At least one inverter is not reachable.</li></ul> Only inverters with polling enabled are considered."},{"location":"firmware/faq/","title":"Frequently Asked Questions","text":""},{"location":"firmware/faq/#how-to-observe-the-esp32-boot-process-by-looking-at-the-serial-console","title":"How to observe the ESP32 boot process by looking at the serial console?","text":"<p>Please see here</p>"},{"location":"firmware/faq/#after-a-firmwware-update-some-new-features-do-not-appear-in-the-web-interface","title":"After a firmwware update some new features do not appear in the web interface","text":"<p>Make sure you reloaded the webinterface after the firmware update. This can be achieved, depending on your browser, by pressing either F5, Ctrl+F5 or just by clicking on the reload button.</p>"},{"location":"firmware/faq/#after-a-firmwware-does-not-get-a-proper-ip-via-dhcp","title":"After a firmwware does not get a proper IP via DHCP","text":"<p>In some cases it is required to perform a power cycle to get it working again.</p>"},{"location":"firmware/faq/#a-set-up-inverter-does-not-appear-in-the-live-view","title":"A set up inverter does not appear in the live view","text":"<p>Double check whether the inverter type in Settings --&gt; Inverter reflects your type or if it's unknown. If it's unknown it will not appear in the live view and you most likely inserted a invalid serial number.</p>"},{"location":"firmware/faq/#is-it-possible-to-reset-the-yield-total-value","title":"Is it possible to reset the yield total value?","text":"<p>The yield total value comes directly out of the inverter. (Currently) there is no way to reset or change this value. Please consider it as the total kilometer counter in a car. On the other hand it's possible to add a yield offset to each inverter. This can be set up in the inverter properties (Settings --&gt; Inverters --&gt; Click on the pen icon)</p>"},{"location":"firmware/faq/#why-get-the-daily-yield-values-sometimes-reset-to-zero-at-the-evening","title":"Why get the daily yield values sometimes reset to zero at the evening?","text":"<p>The values are reset if the inverter restarts. At some (cloudy) evenings it can occur that the brightness fluctuates heavily during the dusk. This could lead to multiple restarts of the inverter and therefor zeros in the production values. You can enable the Yield Day Correction in the inverter settings.</p>"},{"location":"firmware/faq/#opendtu-shows-wrongunrealistic-or-just-missing-values","title":"OpenDTU shows wrong/unrealistic or just missing values","text":"<p>This is most likely the case because two DTUs are querying the same inverter. This is a not supported behavior and can lead to unexpected effects. Only one DTU is allowed to query a specific inverter.</p> <p>Please also see #831, #727</p>"},{"location":"firmware/faq/#with-hms-1800-or-hms-2000-the-reactive-power-shows-unrealistic-value-65535","title":"With HMS-1800 or HMS-2000 the reactive power shows unrealistic value 6.553,5","text":"<p>This seems to be a issue with inverter Firmware 1.0.14. It contains a calculation mistake.</p> <p>Reactive power seems to scale incorrectly / be calculated incorrectly and runs up with increasing power at sunrise from 0 to 0xFFFF and remains there, which can be observed at slow sunrise and sunset again (only in the very low watt range). Since the PF is calculated from P and Q and Q is insanely high, this results in a PF of almost 0.</p> <p>Please also see #926</p>"},{"location":"firmware/faq/#opendtu-does-not-build-error-bad_alloc-was-not-declared-in-this-scope","title":"OpenDTU does not build: \"error: 'bad_alloc' was not declared in this scope\"","text":"<p>The exact reason is not known. But it helps to delete the <code>~/.platformio/</code> folder.</p> <p>Please also see #719</p>"},{"location":"firmware/flash_esp/","title":"Flash ESP32","text":""},{"location":"firmware/flash_esp/#download-firmware","title":"Download Firmware","text":"<p>The pre-compiled binary files can be found on the GitHub Releases Page (the right column on the projects start page). Currently there are pre-compiled binaries for ESP32 and ESP32-S3 MCUs.</p>"},{"location":"firmware/flash_esp/#overview-of-pre-compiled-binaries","title":"Overview of pre-compiled binaries","text":"Binary MCU Device Profile mandatory First Flash / OTA Comment opendtu-generic.bin ESP32 No OTA Deprecated! opendtu-generic.factory.bin ESP32 No First Flash Deprecated! opendtu-generic_esp32.bin ESP32 Yes OTA opendtu-generic_esp32.factory.bin ESP32 Yes First Flash opendtu-generic_esp32s3.bin ESP32-S3 Yes OTA For boards with usb-uart bridge opendtu-generic_esp32s3.factory.bin ESP32-S3 Yes First Flash For boards with usb-uart bridge opendtu-generic_esp32s3_usb.bin ESP32-S3 Yes OTA For boards with integrated usb connection opendtu-generic_esp32s3_usb.factory.bin ESP32-S3 Yes First Flash For boards with integrated usb connection <p>Note</p> <p>All pre-compiled binaries require a mandatory Device Profile. You have to upload one after flashing the firmware!</p>"},{"location":"firmware/flash_esp/#flash-esp32_1","title":"Flash ESP32","text":"<p>Important</p> <p>When flashing OpenDTU onto the ESP32 for the first time, you need to flash it over serial using the factory firmware binary file. You need to write the factory binary to the ESP32 flash chip at address <code>0x0</code>.</p> <p>The factory binary also contains a bootloader and partition scheme needed to properly boot the ESP32.</p> <p>Before starting the flash process you have to put the ESP into flash mode. Most boards are able to do this automatically but sometimes it's not working:</p> <ol> <li>Connect <code>GPIO0</code> to <code>GND</code> before booting the device</li> <li>Power-on or reset the ESP32 while <code>GPIO0</code> is connected to <code>GND</code></li> <li>Start the flash process</li> </ol> <p>The actual procedure to flash the ESP32 depends on the tool used. Click on the tab below that matches your flash tool.</p> ESP Flash Tools ESPtool.py ESP_Flasher Web ESP_Flasher  <p>Espressif provides their own Flash Download Tools for Windows.</p> <p></p> <p>Change <code>COM9</code> to the correct port on your computer.</p> <ul> <li>On startup, select Chip Type --&gt; ESP32 and WorkMode -&gt; Develop</li> <li>Prepare all settings (see picture). Make sure to uncheck the DoNotChgBin option. Otherwise you may get errors like \"invalid header\".</li> <li>Press \"Erase\" button on screen. Look into the terminal window, you should see dots appear. On some boards, the automatic bootloader selection does not work. In this case you have to manually press the \"Boot\" button on the ESP32 board. Wait for \"FINISH\" to see if flashing/erasing is done.</li> <li>To program, press \"Start\" on screen, then the \"Boot\" button (if required).</li> <li>When flashing is complete (FINISH appears) then press the Reset button on the ESP32 board (or powercycle ) to start the OpenDTU application.</li> </ul> <pre><code>esptool.py --port COM1 erase_flash\nesptool.py --port COM1 --chip esp32 --before default_reset --after hard_reset \\\n    write_flash --flash_mode dout --flash_freq 40m --flash_size detect \\\n    0x0 opendtu-generic*.factory.bin\n</code></pre> <p>Change <code>COM1</code> to the correct port on your computer. If you get an error at the end of the flash procedure, you can try with a lower the baudrate eg. 460800.</p> <p>ESP_Flasher - web version</p> <p>It is also possible to flash it via the web tools which might be more convenient and is platform independent.</p> <p>Users report that ESP_Flasher is suitable for flashing OpenDTU on Windows.</p>"},{"location":"firmware/mqtt_topics/","title":"MQTT Topics","text":"<p>The base topic, as configured in the web GUI is prepended to all follwing topics.</p>"},{"location":"firmware/mqtt_topics/#general-topics","title":"General topics","text":"Topic R / W Description Value / Unit <code>dtu/ip</code> R IP address of OpenDTU IP address <code>dtu/hostname</code> R Current hostname of the dtu (as set in web GUI) <code>dtu/rssi</code> R WiFi network quality db value <code>dtu/status</code> R Indicates whether OpenDTU network is reachable online /  offline <code>dtu/uptime</code> R Time in seconds since startup seconds"},{"location":"firmware/mqtt_topics/#inverter-total-topics","title":"Inverter total topics","text":"<p>Enabled inverter means, that only inverters with \"Poll inverter data\" enabled are considered.</p> Topic R / W Description Value / Unit <code>ac/power</code> R Sum of AC active power of all enabled inverters W <code>ac/yieldtotal</code> R Sum of energy converted to AC since reset watt hours of all enabled inverters Kilo watt hours (kWh) <code>ac/yieldday</code> R Sum of energy converted to AC per day in watt hours of all enabled inverters Watt hours (Wh) <code>ac/is_valid</code> R Indicator whether all enabled inverters where reachable 0 or 1 <code>dc/power</code> R Sum of DC power of all enabled inverters Watt (W) <code>dc/irradiation</code> R Produced power of all enabled inverter stripes with defined irradiation settings divided by sum of all enabled inverters irradiation % <code>dc/is_valid</code> R Indicator whether all enabled inverters where reachable 0 or 1"},{"location":"firmware/mqtt_topics/#inverter-specific-topics","title":"Inverter specific topics","text":"<p>serial will be replaced with the serial number of the inverter.</p> Topic R / W Description Value / Unit <code>[serial]/name</code> R Name of the inverter as configured in web GUI <code>[serial]/device/bootloaderversion</code> R Bootloader version of the inverter <code>[serial]/device/fwbuildversion</code> R Firmware version of the inverter <code>[serial]/device/fwbuilddatetime</code> R Build date / time of inverter firmware <code>[serial]/device/hwpartnumber</code> R Hardware part number of the inverter <code>[serial]/device/hwversion</code> R Hardware version of the inverter <code>[serial]/status/reachable</code> R Indicates whether the inverter is reachable 0 or 1 <code>[serial]/status/producing</code> R Indicates whether the inverter is producing AC power 0 or 1 <code>[serial]/status/last_update</code> R Unix timestamp of last inverter statistics udpate seconds since JAN 01 1970 (UTC)"},{"location":"firmware/mqtt_topics/#ac-channel-global-specific-topics","title":"AC channel / global specific topics","text":"Topic R / W Description Value / Unit <code>[serial]/0/current</code> R AC current in ampere Ampere (A) <code>[serial]/0/efficiency</code> R Ratio AC Power over DC Power in percent % <code>[serial]/0/frequency</code> R AC frequency in hertz Hertz (Hz) <code>[serial]/0/power</code> R AC active power in watts Watt (W) <code>[serial]/0/powerdc</code> R DC power in watts Watt (W) <code>[serial]/0/powerfactor</code> R Power factor in percent % <code>[serial]/0/reactivepower</code> R AC reactive power in VAr VAr <code>[serial]/0/temperature</code> R Temperature of inverter in degree celsius Degree Celsius (\u00b0C) <code>[serial]/0/voltage</code> R AC voltage in volt Volt (V) <code>[serial]/0/yieldday</code> R Energy converted to AC per day in watt hours Watt hours (Wh) <code>[serial]/0/yieldtotal</code> R Energy converted to AC since reset watt hours Kilo watt hours (kWh)"},{"location":"firmware/mqtt_topics/#dc-input-channel-topics","title":"DC input channel topics","text":"<p>[1-4] represents the different inputs. The amount depends on the inverter model.</p> Topic R / W Description Value / Unit <code>[serial]/[1-4]/current</code> R DC current of specific input in ampere Ampere (A) <code>[serial]/[1-4]/name</code> R Name of the DC input channel as configured in web GUI <code>[serial]/[1-4]/irradiation</code> R Ratio DC Power over set maximum power (in web GUI) % <code>[serial]/[1-4]/power</code> R DC power of specific input in watt Watt (W) <code>[serial]/[1-4]/voltage</code> R DC voltage of specific input in volt Volt (V) <code>[serial]/[1-4]/yieldday</code> R Energy converted to AC per day on specific input Watt hours (Wh) <code>[serial]/[1-4]/yieldtotal</code> R Energy converted to AC since reset on specific input Kilo watt hours (kWh)"},{"location":"firmware/mqtt_topics/#inverter-limit-specific-topics","title":"Inverter limit specific topics","text":"<p>cmd topics are used to set values. Status topics are updated from values set in the inverter.</p> Topic R / W Description Value / Unit <code>[serial]/status/limit_relative</code> R Current applied production limit of the inverter % of total possible output <code>[serial]/status/limit_absolute</code> R Current applied production limit of the inverter Watt (W) <code>[serial]/cmd/limit_persistent_relative</code> W Set the inverter limit as a percentage of total production capability. The  value will survive the night without power. The updated value will show up in the web GUI and limit_relative topic immediatly. % <code>[serial]/cmd/limit_persistent_absolute</code> W Set the inverter limit as a absolute value. The  value will survive the night without power. The updated value will set immediatly within the inverter but show up in the web GUI and limit_relative topic after around 4 minutes. If you are using a already known inverter (known Hardware ID), the updated value will show up within a few seconds. Watt (W) <code>[serial]/cmd/limit_nonpersistent_relative</code> W Set the inverter limit as a percentage of total production capability. The  value will reset to the last persistent value at night without power. The updated value will show up in the web GUI and limit_relative topic immediatly. The value must be published non-retained, otherwise it will be ignored! % <code>[serial]/cmd/limit_nonpersistent_absolute</code> W Set the inverter limit as a absolute value. The  value will reset to the last persistent value at night without power. The updated value will set immediatly within the inverter but show up in the web GUI and limit_relative topic after around 4 minutes. If you are using a already known inverter (known Hardware ID), the updated value will show up within a few seconds. The value must be published non-retained, otherwise it will be ignored! Watt (W) <code>[serial]/cmd/power</code> W Turn the inverter on (1) or off (0) 0 or 1 <code>[serial]/cmd/restart</code> W Restarts the inverters (also resets YieldDay) 1"},{"location":"firmware/update/","title":"Firmware Update","text":""},{"location":"firmware/update/#over-the-air","title":"Over-The-Air","text":"<p>Once you have your OpenDTU running and connected to WLAN, you can do further updates through the web interface. Navigate to Settings --&gt; Firmware upgrade and press the browse button. Select the firmware file from your local computer.</p> <p></p> <p>If you've installed a pre-compiled firmware in the past (a firmware file which contained <code>opendtu-generic*.factory.bin</code> in it's filename) you can choose the appropriate binary without the suffix <code>.factory</code>.</p> <p>You can find your currently installed binary file in Info --&gt; System --&gt; PIO Environment</p> <p>If you have compiled the firmware by yourself, you'll find the firmware file (after a successful build process) under <code>.pio/build/generic/firmware.bin</code>.</p> <p>After the successful upload, the OpenDTU immediately restarts into the new firmware.</p> <p>Important hint</p> <p>Make sure you reload the web interface after the update. Otherwise you will not see new settings and features. Normally it should be sufficient to reload the page with F5 or by clicking on \"Refresh\". In some cases it may also be necessary to clear the browser cache. This can be done with the key combination Ctrl+F5, for example.</p>"},{"location":"firmware/update/#serial-update","title":"Serial Update","text":""},{"location":"firmware/update/#using-vscode","title":"Using VSCode","text":"<p>If you've uploaded the firmware in the past using VSCode you can just follow the compiling guide to upload it again. All settings are preserved.</p>"},{"location":"firmware/update/#using-flash-tool","title":"Using flash tool","text":"<p>If you are using a flash tool like <code>esptool.py</code>, the web-flasher or the espressif upload tool, make sure you flash the <code>.bin</code> file without the <code>.factory</code> suffix to address <code>0x10000</code>.</p>"},{"location":"firmware/web_api/","title":"Web API","text":"<p>Information in JSON format can be obtained through the web API.</p> <p>Important Note</p> <p>The WebAPI is mainly generated to fetch and post information between the WebUI and the ESP. You use it at your own  risk. It may change in future and break compatibility!</p>"},{"location":"firmware/web_api/#list-of-urls","title":"List of URLs","text":"<p>may be incomplete</p> GET/POST Auth required URL Get yes /api/config/get Post yes /api/config/delete Get yes /api/config/list Post yes /api/config/upload Get+Post yes /api/device/config Get no /api/devinfo/status Get+Post yes /api/dtu/config Get no /api/eventlog/status?inv=inverter-serialnumber Post yes /api/firmware/update Get yes /api/inverter/list Post yes /api/inverter/add Post yes /api/inverter/del Post yes /api/inverter/edit Post yes /api/limit/config Get no /api/limit/status Get no /api/livedata/status Post yes /api/maintenance/reboot Get+Post yes /api/mqtt/config Get no /api/mqtt/status Get+Post yes /api/network/config Get no /api/network/status Get+Post yes /api/ntp/config Get no /api/ntp/status Get+Post yes /api/ntp/time Get no /api/power/status Post yes /api/power/config Get no /api/prometheus/metrics Get+Post yes /api/security/config Get yes /api/security/authenticate Get no /api/system/status"},{"location":"firmware/web_api/#examples-of-use","title":"Examples of Use","text":""},{"location":"firmware/web_api/#important-notes","title":"Important notes","text":"<ul> <li>IP addresses and serial numbers in this examples are anonymized. Adjust to your own needs.</li> <li>The output from curl is without a linefeed at the end, so please be careful when copying the output - do not accidentally add the shell prompt directly after it.</li> <li>When POSTing config data to OpenDTU, always send all settings back, even if only one setting was changed. Sending single settings is not supported and you will receive a response <code>{\"type\":\"warning\",\"message\":\"Values are missing!\"}</code></li> <li>When POSTing, always put single quotes around the data part. Do not confuse the single quote <code>'</code> with the backtick <code>`</code>. You have been warned.</li> <li>Some API calls have a single URL for GET and POST - e.g. <code>/api/ntp/config</code></li> <li>Other API calls use e.g. <code>/api/limit/status</code> to GET data and a different URL <code>/api/limit/config</code> to POST data.</li> <li>If you want to investigate the web api communication, a good tool is Postman</li> <li>Settings API require username and password provided with Basic Authentication credentials</li> <li>If you disable the readonly access to the web API, every endpoint requires authentication</li> </ul>"},{"location":"firmware/web_api/#get-information","title":"Get information","text":"<p>You can \"talk\" to the OpenDTU with a command line tool like <code>curl</code>. The output is in plain JSON, without carriage return/linefeed and is therefore not very human readable.</p>"},{"location":"firmware/web_api/#get-current-livedata","title":"Get current livedata","text":"<pre><code>$ curl http://192.168.10.10/api/livedata/status\n{\"inverters\":[{\"serial\":\"11617160xxxx\",\"name\":\"Meine Solaranlage\",\"data_age\":6983,\"reachable\":false,\"producing\":false,\"limit_relative\":0,\"limit_absolute\":-1,\"AC\":{\"0\":{\"Power\":{\"v\":0,\"u\":\"W\",\"d\":1},\"Voltage\":{\"v\":0,\"u\":\"V\",\"d\":1},\"Current\":{\"v\":0,\"u\":\"A\",\"d\":2},\"Power DC\":{\"v\":0,\"u\":\"W\",\"d\":1},\"YieldDay\":{\"v\":0,\"u\":\"Wh\",\"d\":0},\"YieldTotal\":{\"v\":0,\"u\":\"kWh\",\"d\":3},\"Frequency\":{\"v\":0,\"u\":\"Hz\",\"d\":2},\"PowerFactor\":{\"v\":0,\"u\":\"\",\"d\":3},\"ReactivePower\":{\"v\":0,\"u\":\"var\",\"d\":1},\"Efficiency\":{\"v\":0,\"u\":\"%\",\"d\":3}}},\"DC\":{\"0\":{\"name\":{\"u\":\"\"},\"Power\":{\"v\":0,\"u\":\"W\",\"d\":1},\"Voltage\":{\"v\":0,\"u\":\"V\",\"d\":1},\"Current\":{\"v\":0,\"u\":\"A\",\"d\":2},\"YieldDay\":{\"v\":0,\"u\":\"Wh\",\"d\":0},\"YieldTotal\":{\"v\":0,\"u\":\"kWh\",\"d\":3},\"Irradiation\":{\"v\":0,\"u\":\"%\",\"d\":3}},\"1\":{\"name\":{\"u\":\"\"},\"Power\":{\"v\":0,\"u\":\"W\",\"d\":1},\"Voltage\":{\"v\":0,\"u\":\"V\",\"d\":1},\"Current\":{\"v\":0,\"u\":\"A\",\"d\":2},\"YieldDay\":{\"v\":0,\"u\":\"Wh\",\"d\":0},\"YieldTotal\":{\"v\":0,\"u\":\"kWh\",\"d\":3},\"Irradiation\":{\"v\":0,\"u\":\"%\",\"d\":3}},\"2\":{\"name\":{\"u\":\"\"},\"Power\":{\"v\":0,\"u\":\"W\",\"d\":1},\"Voltage\":{\"v\":0,\"u\":\"V\",\"d\":1},\"Current\":{\"v\":0,\"u\":\"A\",\"d\":2},\"YieldDay\":{\"v\":0,\"u\":\"Wh\",\"d\":0},\"YieldTotal\":{\"v\":0,\"u\":\"kWh\",\"d\":3},\"Irradiation\":{\"v\":0,\"u\":\"%\",\"d\":3}},\"3\":{\"name\":{\"u\":\"\"},\"Power\":{\"v\":0,\"u\":\"W\",\"d\":1},\"Voltage\":{\"v\":0,\"u\":\"V\",\"d\":1},\"Current\":{\"v\":0,\"u\":\"A\",\"d\":2},\"YieldDay\":{\"v\":0,\"u\":\"Wh\",\"d\":0},\"YieldTotal\":{\"v\":0,\"u\":\"kWh\",\"d\":3}}},\"INV\":{\"0\":{\"Temperature\":{\"v\":0,\"u\":\"\u00b0C\",\"d\":1}}},\"events\":0},{\"serial\":\"11417160xxxx\",\"name\":\"test\",\"data_age\":6983,\"reachable\":false,\"producing\":false,\"limit_relative\":0,\"limit_absolute\":-1,\"AC\":{\"0\":{\"Power\":{\"v\":0,\"u\":\"W\",\"d\":1},\"Voltage\":{\"v\":0,\"u\":\"V\",\"d\":1},\"Current\":{\"v\":0,\"u\":\"A\",\"d\":2},\"Power DC\":{\"v\":0,\"u\":\"W\",\"d\":1},\"YieldDay\":{\"v\":0,\"u\":\"Wh\",\"d\":0},\"YieldTotal\":{\"v\":0,\"u\":\"kWh\",\"d\":3},\"Frequency\":{\"v\":0,\"u\":\"Hz\",\"d\":2},\"PowerFactor\":{\"v\":0,\"u\":\"\",\"d\":3},\"ReactivePower\":{\"v\":0,\"u\":\"var\",\"d\":1},\"Efficiency\":{\"v\":0,\"u\":\"%\",\"d\":3}}},\"DC\":{\"0\":{\"name\":{\"u\":\"test 1\"},\"Power\":{\"v\":0,\"u\":\"W\",\"d\":1},\"Voltage\":{\"v\":0,\"u\":\"V\",\"d\":1},\"Current\":{\"v\":0,\"u\":\"A\",\"d\":2},\"YieldDay\":{\"v\":0,\"u\":\"Wh\",\"d\":0},\"YieldTotal\":{\"v\":0,\"u\":\"kWh\",\"d\":3},\"Irradiation\":{\"v\":0,\"u\":\"%\",\"d\":3}},\"1\":{\"name\":{\"u\":\"test 2\"},\"Power\":{\"v\":0,\"u\":\"W\",\"d\":1},\"Voltage\":{\"v\":0,\"u\":\"V\",\"d\":1},\"Current\":{\"v\":0,\"u\":\"A\",\"d\":2},\"YieldDay\":{\"v\":0,\"u\":\"Wh\",\"d\":0},\"YieldTotal\":{\"v\":0,\"u\":\"kWh\",\"d\":3},\"Irradiation\":{\"v\":0,\"u\":\"%\",\"d\":3}}},\"INV\":{\"0\":{\"Temperature\":{\"v\":0,\"u\":\"\u00b0C\",\"d\":1}}},\"events\":0}],\"total\":{\"Power\":{\"v\":0,\"u\":\"W\",\"d\":1},\"YieldDay\":{\"v\":0,\"u\":\"Wh\",\"d\":0},\"YieldTotal\":{\"v\":0,\"u\":\"kWh\",\"d\":2}},\"hints\":{\"time_sync\":false,\"radio_problem\":false,\"default_password\":false}}\n</code></pre> <p>To enhance readability (and filter information) use the JSON command line processor <code>jq</code>.</p> <pre><code>$ curl --no-progress-meter http://192.168.10.10/api/livedata/status | jq\n{\n  \"inverters\": [\n    {\n      \"serial\": \"116171603546\",\n      \"name\": \"Meine Solaranlage\",\n      \"data_age\": 7038,\n      \"reachable\": false,\n      \"producing\": false,\n      \"limit_relative\": 0,\n      \"limit_absolute\": -1,\n      \"AC\": {\n        \"0\": {\n          \"Power\": {\n            \"v\": 0,\n            \"u\": \"W\",\n            \"d\": 1\n          },\n          \"Voltage\": {\n            \"v\": 0,\n            \"u\": \"V\",\n            \"d\": 1\n          },\n          \"Current\": {\n            \"v\": 0,\n            \"u\": \"A\",\n            \"d\": 2\n          },\n          \"Power DC\": {\n            \"v\": 0,\n            \"u\": \"W\",\n            \"d\": 1\n          },\n          \"YieldDay\": {\n            \"v\": 0,\n            \"u\": \"Wh\",\n            \"d\": 0\n          },\n          \"YieldTotal\": {\n            \"v\": 0,\n            \"u\": \"kWh\",\n            \"d\": 3\n          },\n          \"Frequency\": {\n            \"v\": 0,\n            \"u\": \"Hz\",\n            \"d\": 2\n          },\n          \"PowerFactor\": {\n            \"v\": 0,\n            \"u\": \"\",\n            \"d\": 3\n          },\n          \"ReactivePower\": {\n            \"v\": 0,\n            \"u\": \"var\",\n            \"d\": 1\n          },\n          \"Efficiency\": {\n            \"v\": 0,\n            \"u\": \"%\",\n            \"d\": 3\n          }\n        }\n      },\n      \"DC\": {\n        \"0\": {\n          \"name\": {\n            \"u\": \"\"\n          },\n          \"Power\": {\n            \"v\": 0,\n            \"u\": \"W\",\n            \"d\": 1\n          },\n          \"Voltage\": {\n            \"v\": 0,\n            \"u\": \"V\",\n            \"d\": 1\n          },\n          \"Current\": {\n            \"v\": 0,\n            \"u\": \"A\",\n            \"d\": 2\n          },\n          \"YieldDay\": {\n            \"v\": 0,\n            \"u\": \"Wh\",\n            \"d\": 0\n          },\n          \"YieldTotal\": {\n            \"v\": 0,\n            \"u\": \"kWh\",\n            \"d\": 3\n          },\n          \"Irradiation\": {\n            \"v\": 0,\n            \"u\": \"%\",\n            \"d\": 3\n          }\n        },\n        \"1\": {\n          \"name\": {\n            \"u\": \"\"\n          },\n          \"Power\": {\n            \"v\": 0,\n            \"u\": \"W\",\n            \"d\": 1\n          },\n          \"Voltage\": {\n            \"v\": 0,\n            \"u\": \"V\",\n            \"d\": 1\n          },\n          \"Current\": {\n            \"v\": 0,\n            \"u\": \"A\",\n            \"d\": 2\n          },\n          \"YieldDay\": {\n            \"v\": 0,\n            \"u\": \"Wh\",\n            \"d\": 0\n          },\n          \"YieldTotal\": {\n            \"v\": 0,\n            \"u\": \"kWh\",\n            \"d\": 3\n          },\n          \"Irradiation\": {\n            \"v\": 0,\n            \"u\": \"%\",\n            \"d\": 3\n          }\n        },\n        \"2\": {\n          \"name\": {\n            \"u\": \"\"\n          },\n          \"Power\": {\n            \"v\": 0,\n            \"u\": \"W\",\n            \"d\": 1\n          },\n          \"Voltage\": {\n            \"v\": 0,\n            \"u\": \"V\",\n            \"d\": 1\n          },\n          \"Current\": {\n            \"v\": 0,\n            \"u\": \"A\",\n            \"d\": 2\n          },\n          \"YieldDay\": {\n            \"v\": 0,\n            \"u\": \"Wh\",\n            \"d\": 0\n          },\n          \"YieldTotal\": {\n            \"v\": 0,\n            \"u\": \"kWh\",\n            \"d\": 3\n          },\n          \"Irradiation\": {\n            \"v\": 0,\n            \"u\": \"%\",\n            \"d\": 3\n          }\n        },\n        \"3\": {\n          \"name\": {\n            \"u\": \"\"\n          },\n          \"Power\": {\n            \"v\": 0,\n            \"u\": \"W\",\n            \"d\": 1\n          },\n          \"Voltage\": {\n            \"v\": 0,\n            \"u\": \"V\",\n            \"d\": 1\n          },\n          \"Current\": {\n            \"v\": 0,\n            \"u\": \"A\",\n            \"d\": 2\n          },\n          \"YieldDay\": {\n            \"v\": 0,\n            \"u\": \"Wh\",\n            \"d\": 0\n          },\n          \"YieldTotal\": {\n            \"v\": 0,\n            \"u\": \"kWh\",\n            \"d\": 3\n          }\n        }\n      },\n      \"INV\": {\n        \"0\": {\n          \"Temperature\": {\n            \"v\": 0,\n            \"u\": \"\u00b0C\",\n            \"d\": 1\n          }\n        }\n      },\n      \"events\": 0\n    },\n    {\n      \"serial\": \"114171603548\",\n      \"name\": \"test\",\n      \"data_age\": 7038,\n      \"reachable\": false,\n      \"producing\": false,\n      \"limit_relative\": 0,\n      \"limit_absolute\": -1,\n      \"AC\": {\n        \"0\": {\n          \"Power\": {\n            \"v\": 0,\n            \"u\": \"W\",\n            \"d\": 1\n          },\n          \"Voltage\": {\n            \"v\": 0,\n            \"u\": \"V\",\n            \"d\": 1\n          },\n          \"Current\": {\n            \"v\": 0,\n            \"u\": \"A\",\n            \"d\": 2\n          },\n          \"Power DC\": {\n            \"v\": 0,\n            \"u\": \"W\",\n            \"d\": 1\n          },\n          \"YieldDay\": {\n            \"v\": 0,\n            \"u\": \"Wh\",\n            \"d\": 0\n          },\n          \"YieldTotal\": {\n            \"v\": 0,\n            \"u\": \"kWh\",\n            \"d\": 3\n          },\n          \"Frequency\": {\n            \"v\": 0,\n            \"u\": \"Hz\",\n            \"d\": 2\n          },\n          \"PowerFactor\": {\n            \"v\": 0,\n            \"u\": \"\",\n            \"d\": 3\n          },\n          \"ReactivePower\": {\n            \"v\": 0,\n            \"u\": \"var\",\n            \"d\": 1\n          },\n          \"Efficiency\": {\n            \"v\": 0,\n            \"u\": \"%\",\n            \"d\": 3\n          }\n        }\n      },\n      \"DC\": {\n        \"0\": {\n          \"name\": {\n            \"u\": \"test 1\"\n          },\n          \"Power\": {\n            \"v\": 0,\n            \"u\": \"W\",\n            \"d\": 1\n          },\n          \"Voltage\": {\n            \"v\": 0,\n            \"u\": \"V\",\n            \"d\": 1\n          },\n          \"Current\": {\n            \"v\": 0,\n            \"u\": \"A\",\n            \"d\": 2\n          },\n          \"YieldDay\": {\n            \"v\": 0,\n            \"u\": \"Wh\",\n            \"d\": 0\n          },\n          \"YieldTotal\": {\n            \"v\": 0,\n            \"u\": \"kWh\",\n            \"d\": 3\n          },\n          \"Irradiation\": {\n            \"v\": 0,\n            \"u\": \"%\",\n            \"d\": 3\n          }\n        },\n        \"1\": {\n          \"name\": {\n            \"u\": \"test 2\"\n          },\n          \"Power\": {\n            \"v\": 0,\n            \"u\": \"W\",\n            \"d\": 1\n          },\n          \"Voltage\": {\n            \"v\": 0,\n            \"u\": \"V\",\n            \"d\": 1\n          },\n          \"Current\": {\n            \"v\": 0,\n            \"u\": \"A\",\n            \"d\": 2\n          },\n          \"YieldDay\": {\n            \"v\": 0,\n            \"u\": \"Wh\",\n            \"d\": 0\n          },\n          \"YieldTotal\": {\n            \"v\": 0,\n            \"u\": \"kWh\",\n            \"d\": 3\n          },\n          \"Irradiation\": {\n            \"v\": 0,\n            \"u\": \"%\",\n            \"d\": 3\n          }\n        }\n      },\n      \"INV\": {\n        \"0\": {\n          \"Temperature\": {\n            \"v\": 0,\n            \"u\": \"\u00b0C\",\n            \"d\": 1\n          }\n        }\n      },\n      \"events\": 0\n    }\n  ],\n  \"total\": {\n    \"Power\": {\n      \"v\": 0,\n      \"u\": \"W\",\n      \"d\": 1\n    },\n    \"YieldDay\": {\n      \"v\": 0,\n      \"u\": \"Wh\",\n      \"d\": 0\n    },\n    \"YieldTotal\": {\n      \"v\": 0,\n      \"u\": \"kWh\",\n      \"d\": 2\n    }\n  },\n  \"hints\": {\n    \"time_sync\": false,\n    \"radio_problem\": false,\n    \"default_password\": false\n  }\n}\n</code></pre> <p>The eventlog can be fetched with the inverter serial number as parameter:</p> <pre><code>$ curl --no-progress-meter http://192.168.10.10/api/eventlog/status?inv=11418186xxxx | jq\n{\n  \"11418186xxxx\": {\n    \"count\": 4,\n    \"events\": [\n      {\n        \"message_id\": 1,\n        \"message\": \"Inverter start\",\n        \"start_time\": 28028,\n        \"end_time\": 28028\n      },\n      {\n        \"message_id\": 209,\n        \"message\": \"PV-1: No input\",\n        \"start_time\": 28036,\n        \"end_time\": 0\n      },\n      {\n        \"message_id\": 2,\n        \"message\": \"DTU command failed\",\n        \"start_time\": 28092,\n        \"end_time\": 28092\n      },\n      {\n        \"message_id\": 207,\n        \"message\": \"MPPT-A: Input undervoltage\",\n        \"start_time\": 28336,\n        \"end_time\": 0\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"firmware/web_api/#combine-curl-and-jq","title":"combine curl and jq","text":"<p><code>jq</code> can filter specific fields from json output.</p> <p>For example, filter out the current total power:</p> <pre><code>$ curl --no-progress-meter http://192.168.10.10/api/livedata/status | jq '.total | .Power.v'\n140.7999878\n</code></pre>"},{"location":"firmware/web_api/#get-information-where-login-is-required","title":"Get information where login is required","text":"<p>When config data is requested, username and password have to be provided to <code>curl</code> Username is always <code>admin</code>, the default password is <code>openDTU42</code>. The password is used for both the admin login and the Admin-mode Access Point.</p> <pre><code>$ curl --u admin:openDTU42 http://192.168.10.10/api/ntp/config\n{\"ntp_server\":\"pool.ntp.org\",\"ntp_timezone\":\"CET-1CEST,M3.5.0,M10.5.0/3\",\"ntp_timezone_descr\":\"Europe/Berlin\"}\n</code></pre>"},{"location":"firmware/web_api/#post-information","title":"Post information","text":"<p>With HTTP POST commands information can be written to the OpenDTU.</p> <p>The Web API is designed to allow the web frontend in the web browser to communicate with the OpenDTU software running on the ESP32. It is not designed to be intuitive or user-friendly, so please follow the instructions here.</p>"},{"location":"firmware/web_api/#example-1-change-ntp-settings","title":"Example 1: change ntp settings","text":"<p>If you want to configure the ntp server setting, first fetch the information from the web API:</p> <pre><code>$ curl -u \"admin:password\" http://192.168.10.10/api/ntp/config\n{\"ntp_server\":\"pool.ntp.org\",\"ntp_timezone\":\"CET-1CEST,M3.5.0,M10.5.0/3\",\"ntp_timezone_descr\":\"Europe/Berlin\"}\n</code></pre> <p>Then, second step, send your new settings. Use the text output from curl in the first step, add <code>data=</code> and enclose the whole data with single quotes.</p> <pre><code>$ curl -u \"admin:password\" http://192.168.10.10/api/ntp/config -d 'data={\"ntp_server\":\"my.own.ntp.server.home\",\"ntp_timezone\":\"CET-1CEST,M3.5.0,M10.5.0/3\",\"ntp_timezone_descr\":\"Europe/Berlin\"}'\n{\"type\":\"success\",\"message\":\"Settings saved!\"}\n</code></pre> <p>You will receive a json formatted response.</p>"},{"location":"firmware/web_api/#example-2-change-power-limit","title":"Example 2: change power limit","text":"<p>In the second example, I want to change the non persistent power limit of an inverter. Again, first fetch current data:</p> <pre><code>$ curl http://192.168.10.10/api/limit/status\n{\"11418186xxxx\":{\"limit_relative\":100,\"max_power\":600,\"limit_set_status\":\"Ok\"},\"11418180xxxx\":{\"limit_relative\":100,\"max_power\":800,\"limit_set_status\":\"Ok\"}}\n</code></pre> <p>I see data from two configured inverters.</p> <p>Now I set the relative power limit of inverter with serialnumber <code>11418180xxxx</code> to 50%.</p> <pre><code>$ curl -u \"admin:password\" http://192.168.10.10/api/limit/config -d 'data={\"serial\":\"11418180xxxx\", \"limit_type\":1, \"limit_value\":50}'\n{\"type\":\"success\",\"message\":\"Settings saved!\"}\n</code></pre> <p>Then I read again the limit status. In the first answer the status is <code>pending</code>, some seconds later it changed to <code>OK</code>.</p> <pre><code>$ curl http://192.168.10.10/api/limit/status\n{\"11418186xxxx\":{\"limit_relative\":100,\"max_power\":600,\"limit_set_status\":\"Ok\"},\"11418180xxxx\":{\"limit_relative\":100,\"max_power\":800,\"limit_set_status\":\"Pending\"}}\n\n...\n\n$ curl http://192.168.10.10/api/limit/status\n{\"11418186xxxx\":{\"limit_relative\":100,\"max_power\":600,\"limit_set_status\":\"Ok\"},\"11418180xxxx\":{\"limit_relative\":50,\"max_power\":800,\"limit_set_status\":\"Ok\"}}\n</code></pre>"},{"location":"firmware/wifi_setup/","title":"Wi-Fi Setup","text":"<p>At startup, when no Wi-Fi setup is found, the device will create an initial Access Point for configuring the device.</p> <ul> <li>After the initial flashing of the microcontroller, an Access Point called \"OpenDTU-*\" is opened. The default password is <code>openDTU42</code>.</li> <li>Use a web browser to open the address http://192.168.4.1</li> <li>Navigate to Settings --&gt; Network Settings and enter your WiFi credentials. The username to access the config menu is \"admin\" and the password the same as for accessing the Access Point (default: <code>openDTU42</code>).</li> <li>OpenDTU then simultaneously connects to your WiFi AP with these credentials. Navigate to Info --&gt; Network and look into section \"Network Interface (Station)\" for the IP address received via DHCP.</li> <li>If your WiFi AP uses an allow-list for MAC-addresses, please be aware that the ESP32 has two different MAC addresses for its AP and client modes, they are also listed at Info --&gt; Network.</li> <li>When OpenDTU is connected to a configured WiFI AP, the \"OpenDTU-*\" Access Point is closed after 3 minutes.</li> </ul> <p>Note</p> <ul> <li>OpenDTU needs access to a working NTP server to get the current date &amp; time. Both are sent to the inverter with each request. Default NTP server is pool.ntp.org. If your network has different requirements please change accordingly (Settings --&gt; NTP Settings).</li> <li>Add your inverter in the inverter settings (Settings --&gt; Inverter Settings)</li> </ul>"},{"location":"firmware/configuration/about/","title":"About","text":""},{"location":"firmware/configuration/about/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/config_settings/","title":"Config Management","text":""},{"location":"firmware/configuration/config_settings/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/config_settings/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/config_settings/#backup-configuration-file-backup","title":"Backup: Configuration File Backup","text":""},{"location":"firmware/configuration/config_settings/#backup-the-configuration-file","title":"Backup the configuration file","text":"<p>Select the configuration file which you want to download.</p>"},{"location":"firmware/configuration/config_settings/#backup","title":"Backup","text":"<p>Press this button to download the previously selected config file. The format of this file is <code>.json</code> and can be opened with any text editor.</p>"},{"location":"firmware/configuration/config_settings/#restore-restore-the-configuration-file","title":"Restore: Restore the Configuration File","text":""},{"location":"firmware/configuration/config_settings/#target-file-selection","title":"Target file selection","text":"<p>Select the file type which you are going to upload. The following values are possible:</p> <ul> <li>Main Config (config.json): A config file which was previously backuped</li> <li>Pin Mapping (pin_mapping.json): A Device Profile configuration file.</li> </ul> <p>Warning</p> <p>There is no further check if the uploaded file is valid. Properly check your settings!</p>"},{"location":"firmware/configuration/config_settings/#source-file-selection","title":"Source file selection","text":"<p>Select the source file on your computer which you like to upload to the ESP.</p>"},{"location":"firmware/configuration/config_settings/#restore","title":"Restore","text":"<p>Press this button to upload the selected source file to the specified target file. Afterwards the ESP automatically reboots and reads the uploaded file.</p>"},{"location":"firmware/configuration/config_settings/#initialize-perform-factory-reset","title":"Initialize: Perform Factory Reset","text":""},{"location":"firmware/configuration/config_settings/#restore-factory-default-settings","title":"Restore Factory-Default Settings","text":"<p>This will delete the <code>config.json</code> file on the internal memory and therefor reset all settings to it's defaults. The <code>pin_mapping.json</code> file is preserved but the previously selected Device Profile is set to default values. After deleting all settings a automatic reboot is performed and the initial Access Point is opened again.</p>"},{"location":"firmware/configuration/console/","title":"Console","text":""},{"location":"firmware/configuration/console/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/console/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/console/#virtual-debug-console","title":"Virtual Debug Console","text":"<p>The virtual console shows (almost) the same as the serial console except for core dumps etc. The whole communication with the inverters or received MQTT topics are shown.</p>"},{"location":"firmware/configuration/console/#enable-auto-scroll","title":"Enable Auto Scroll","text":"<p>When enabled, the console automatically scrolls to the most current entry.</p>"},{"location":"firmware/configuration/console/#clear-console","title":"Clear Console","text":"<p>Use this button to erase all the output.</p>"},{"location":"firmware/configuration/console/#copy-to-clipboard","title":"Copy to clipboard","text":"<p>Use this button to copy the whole output to the clipboard.</p>"},{"location":"firmware/configuration/device_reboot/","title":"Device Reboot","text":""},{"location":"firmware/configuration/device_reboot/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/device_reboot/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/device_reboot/#perform-reboot","title":"Perform Reboot","text":""},{"location":"firmware/configuration/device_reboot/#reboot","title":"Reboot","text":"<p>Press this button to restart the ESP. A additional confirmation is required before the action is performed.</p>"},{"location":"firmware/configuration/device_settings/","title":"Device-Manager","text":""},{"location":"firmware/configuration/device_settings/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/device_settings/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/device_settings/#connection-settings","title":"Connection Settings","text":""},{"location":"firmware/configuration/device_settings/#selected-profile","title":"Selected profile","text":"<p>The drop-down shows an overview of all Device Profiles available in your <code>pin_mapping.json</code> file. If you select one of the mappings and press Save the DTU will be restarted and the appropriate pins will be used.</p>"},{"location":"firmware/configuration/device_settings/#connection-overview","title":"Connection overview","text":"<p>The table shows all available pin configurations and how they are assigned currently (column \"Active\"). The column \"Selected\" shows the pin assignment according to the currently selected profile. If there are differences between \"Active\" and \"Selected\" the cells are highlighted. That means you can select different profiles (without clicking Save) and watch which pins will change.</p>"},{"location":"firmware/configuration/device_settings/#display","title":"Display","text":"<p>This settings apply to a properbly connected display. See Device Profiles for display types and pin assignment.</p>"},{"location":"firmware/configuration/device_settings/#enable-power-save","title":"Enable Power Save","text":"<p>Turns off the display if no inverter is producing.</p>"},{"location":"firmware/configuration/device_settings/#enable-screensaver","title":"Enable Screensaver","text":"<p>Move the display a little bit on each update to prevent burn-in. This is useful especially for OLED displays.</p>"},{"location":"firmware/configuration/device_settings/#diagram-duration","title":"Diagram duration","text":"<p>The time period which is shown in the Diagram. If you like e.g. show the production of the last hour, set the value to <code>3600</code>.</p>"},{"location":"firmware/configuration/device_settings/#display-language","title":"Display language","text":"<p>The language of the display text. (e.g. german \"Heute\" instead of english \"Today\")</p>"},{"location":"firmware/configuration/device_settings/#rotation","title":"Rotation","text":"<p>This allows to rotate the display content based on your alignment.</p>"},{"location":"firmware/configuration/device_settings/#contrast","title":"Contrast","text":"<p>The contrast setting is only supported by some displays and the impact is also display specific.</p>"},{"location":"firmware/configuration/device_settings/#leds","title":"LEDs","text":"<p>This settings apply to properbly connected LEDs<sup>1</sup>. See Device Profiles for LED function and pin assignment.</p>"},{"location":"firmware/configuration/device_settings/#equal-brightness","title":"Equal brightness","text":"<p>When enabled, all sliders are set to the same value.</p>"},{"location":"firmware/configuration/device_settings/#led-0-brightness","title":"LED 0 brightness","text":"<p>Sets the brightness of the LED to a specific value. This is useful if the LED is too dazzling, for example.</p>"},{"location":"firmware/configuration/device_settings/#led-1-brightness","title":"LED 1 brightness","text":"<p>Please see LED 0 brightness.</p> <ol> <li> <p>Light-emitting diode \u21a9</p> </li> </ol>"},{"location":"firmware/configuration/dtu_settings/","title":"DTU Settings","text":""},{"location":"firmware/configuration/dtu_settings/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/dtu_settings/#settings-parameters","title":"Settings / Parameters","text":"<p>The possible settings depend on the RF module (NRF24L01+ or CMT2300A) used. If you have configured both modules in your Device Profile, the settings for both modules will appear.</p>"},{"location":"firmware/configuration/dtu_settings/#dtu-configuration","title":"DTU Configuration","text":""},{"location":"firmware/configuration/dtu_settings/#serial","title":"Serial","text":"<p>The serial of the DTU which is used to communicate with the inverters. It's like the inverter serial number but belongs to the DTU. A random number is generated on the first start of the OpenDTU and persisted in the configuration. It is important that all the DTU's in RF<sup>1</sup> range have different serial numbers.</p>"},{"location":"firmware/configuration/dtu_settings/#poll-interval","title":"Poll Interval:","text":"<p>The time (in seconds) between the individual inverter queries. If you choose this value to small the ESP does not have enough time to perform other tasks.</p>"},{"location":"firmware/configuration/dtu_settings/#nrf24-transmitting-power","title":"NRF24 Transmitting power","text":"<p>Specify the transmit power of the RF module. Choose it according to the phrase: \"As large as necessary, as small as possible.\" If you select a value that is too high, the power supply unit may not be able to supply enough current (especially low-cost power supply units are affected). Additional capacitors on the RF module can help here.</p> <p>Possible values:</p> <ul> <li>Minimum (-18dBm)</li> <li>Low (-12dBm)</li> <li>High (-6dBm)</li> <li>Maximum (0dBm)</li> </ul> <p>Warning</p> <p>Please make sure the maximum transmission power does not exeed you local regulations!</p>"},{"location":"firmware/configuration/dtu_settings/#cmt2300a-transmitting-power","title":"CMT2300A Transmitting power","text":"<p>Please see NRF24 Transmitting power. There is a more granular setting option.</p>"},{"location":"firmware/configuration/dtu_settings/#cmt2300a-frequency","title":"CMT2300A frequency","text":"<p>After starting an HMS/HMT inverter (or after 15 minutes without communication), it listens on a frequency of 865 MHz in Europe or 915 MHz for US devices (-NA). In Europe, the DTU must change this frequency before further communication. This is the value that can be set here. If communication with the inverter is not possible, it is possible that radio communication is already taking place on the corresponding frequency. In this case, the value must be adjusted slightly. For US devices, this value must be permanently set to 915 MHz.</p> <p>Warning</p> <p>Please check your local regulations if you are allowed to send on the choosen frequency with the specified transmit power!</p> <ol> <li> <p>Radio frequency \u21a9</p> </li> </ol>"},{"location":"firmware/configuration/firmware_upgrade/","title":"Firmware Upgrade","text":""},{"location":"firmware/configuration/firmware_upgrade/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/firmware_upgrade/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/firmware_upgrade/#firmware-upload","title":"Firmware Upload","text":""},{"location":"firmware/configuration/firmware_upgrade/#file-selection","title":"File selection","text":"<p>Choose the firmware file which you want to flash. See this overview for a list of pre-compiled files. After the upload and flash process is complete the device will automatically restart. For further information please refere to the Update Instructions.</p>"},{"location":"firmware/configuration/inverter_settings/","title":"Inverter Settings","text":""},{"location":"firmware/configuration/inverter_settings/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/inverter_settings/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/live_view/","title":"Main","text":""},{"location":"firmware/configuration/live_view/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/live_view/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/live_view_eventlog/","title":"Eventlog","text":""},{"location":"firmware/configuration/live_view_eventlog/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/live_view_eventlog/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/live_view_gridprofile/","title":"Grid Profile","text":""},{"location":"firmware/configuration/live_view_gridprofile/#screenshots","title":"Screenshots","text":""},{"location":"firmware/configuration/live_view_gridprofile/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/live_view_info/","title":"Inverter Info","text":""},{"location":"firmware/configuration/live_view_info/#screenshots","title":"Screenshots","text":""},{"location":"firmware/configuration/live_view_info/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/live_view_limit/","title":"Limit Settings","text":""},{"location":"firmware/configuration/live_view_limit/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/live_view_limit/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/live_view_power/","title":"Power Settings","text":""},{"location":"firmware/configuration/live_view_power/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/live_view_power/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/login/","title":"Login","text":""},{"location":"firmware/configuration/login/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/mqtt_info/","title":"MQTT Information","text":""},{"location":"firmware/configuration/mqtt_info/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/mqtt_info/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/mqtt_info/#configuration-summary","title":"Configuration Summary","text":""},{"location":"firmware/configuration/mqtt_info/#home-assistant-mqtt-auto-discovery-configuration-summary","title":"Home Assistant MQTT Auto Discovery Configuration Summary","text":""},{"location":"firmware/configuration/mqtt_info/#runtime-summary","title":"Runtime Summary","text":""},{"location":"firmware/configuration/mqtt_settings/","title":"MQTT Settings","text":"<p>Tip: Learn more about the protocol on MQTT Essentials</p>"},{"location":"firmware/configuration/mqtt_settings/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/mqtt_settings/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/mqtt_settings/#mqtt-configuration","title":"MQTT Configuration","text":""},{"location":"firmware/configuration/mqtt_settings/#enable-mqtt","title":"Enable MQTT","text":"<p>Enables or disables the MQTT functionality.</p>"},{"location":"firmware/configuration/mqtt_settings/#enable-home-assistant-mqtt-auto-discovery","title":"Enable Home Assistant MQTT Auto Discovery","text":"<p>Enables or disables the Home Assistant MQTT Auto Discovery functionality.</p>"},{"location":"firmware/configuration/mqtt_settings/#mqtt-broker-parameter","title":"MQTT Broker Parameter","text":"<p>This settings are only visible if MQTT is enabled.</p>"},{"location":"firmware/configuration/mqtt_settings/#hostname","title":"Hostname","text":"<p>Host name or IP address of your MQTT broker. Make sure your DNS servers are set-up properly if you specify a host name.</p>"},{"location":"firmware/configuration/mqtt_settings/#port","title":"Port","text":"<p>Port of your MQTT broker. Default port for unencrypted connections is <code>1883</code> and for encrypted connections <code>8883</code>.</p>"},{"location":"firmware/configuration/mqtt_settings/#username","title":"Username","text":"<p>Optional username to connect to your MQTT broker. Leave emtpy to perform an anonymous connection.</p>"},{"location":"firmware/configuration/mqtt_settings/#password","title":"Password","text":"<p>Optional password to connect to your MQTT broker.</p>"},{"location":"firmware/configuration/mqtt_settings/#base-topic","title":"Base Topic","text":"<p>Below the base topic all the payload data is published via separate topics. An overview of all available topics can be found here.</p>"},{"location":"firmware/configuration/mqtt_settings/#publish-interval","title":"Publish Interval","text":"<p>The interval at which the MQTT data is published.</p>"},{"location":"firmware/configuration/mqtt_settings/#enable-cleansession-flag","title":"Enable CleanSession flag","text":"<p>Enables the CleanSession<sup>3</sup> flag for MQTT communication.</p>"},{"location":"firmware/configuration/mqtt_settings/#enable-retain-flag","title":"Enable Retain flag","text":"<p>Publish all information with retain<sup>2</sup> flag. This has the advantage that each value is immediatly avilable if you connect to your broker and subscribe to the specific topics you will get immediatly the latest values.</p>"},{"location":"firmware/configuration/mqtt_settings/#enable-tls","title":"Enable TLS","text":"<p>Enables a secure TLS connection to your MQTT broker. If using this you have to get a proper certificate (self signed will not work, is has to be signed by a CA) and the hostname entered as MQTT Hostname must match the CN in the certificate. You must also specify the CA-Root-Certificate.</p>"},{"location":"firmware/configuration/mqtt_settings/#ca-root-certificate","title":"CA-Root-Certificate","text":"<p>The root certificate of your CA if you are using a TLS connection to your broker. Should include the <code>-----BEGIN CERTIFICATE-----</code> and <code>-----END CERTIFICATE-----</code> tags.</p>"},{"location":"firmware/configuration/mqtt_settings/#enable-tls-certificate-login","title":"Enable TLS Certificate Login","text":"<p>Uses certificates to authenticate agains a MQTT broker. When enabled, the TLS Client-Certificate and the TLS Client-Key has to be supplied.</p>"},{"location":"firmware/configuration/mqtt_settings/#tls-client-certificate","title":"TLS Client-Certificate","text":"<p>Should include the <code>-----BEGIN CERTIFICATE-----</code> and <code>-----END CERTIFICATE-----</code> tags.</p>"},{"location":"firmware/configuration/mqtt_settings/#tls-client-key","title":"TLS Client-Key","text":"<p>Should include the <code>-----BEGIN CERTIFICATE-----</code> and <code>-----END CERTIFICATE-----</code> tags.</p>"},{"location":"firmware/configuration/mqtt_settings/#lwt-parameters","title":"LWT Parameters","text":"<p>This settings are only visible if MQTT is enabled.</p>"},{"location":"firmware/configuration/mqtt_settings/#lwt-topic","title":"LWT Topic","text":"<p>Sets the topic of the LWT<sup>1</sup> Message</p>"},{"location":"firmware/configuration/mqtt_settings/#lwt-online-message","title":"LWT Online message","text":"<p>Sets the payload that will be published to the LWT Topic if the device comes online.</p>"},{"location":"firmware/configuration/mqtt_settings/#lwt-offline-message","title":"LWT Offline message","text":"<p>Sets the payload that will be set to the LWT Topic if the device becomes unavailable.</p>"},{"location":"firmware/configuration/mqtt_settings/#qos-quality-of-service","title":"QoS (Quality of Service)","text":"<p>Sets the QoS of the LWT topic.</p>"},{"location":"firmware/configuration/mqtt_settings/#home-assistant-mqtt-auto-discovery-parameters","title":"Home Assistant MQTT Auto Discovery Parameters","text":"<p>This settings are only visible if Enable Home Assistant MQTT Auto Discovery is enabled.</p> <p>Home Assistant provide the MQTT integration and through this integration it is possible to exploit and manage the messages published by OpenDTU. Once this integration on home assistant is configured with the same MQTT broker, it is possible to create devices manually or through the autodiscovery function.</p>"},{"location":"firmware/configuration/mqtt_settings/#prefix-topic","title":"Prefix Topic","text":"<p>The base under which all Home Assistant MQTT Auto Discovery magic happens. If you haven't changed this topic in your Home Assistant installation the default <code>homeassistant/</code> is the right one.</p>"},{"location":"firmware/configuration/mqtt_settings/#enable-retain-flag_1","title":"Enable Retain Flag","text":"<p>Publish all auto discovery information with retain<sup>2</sup> flag. This has the advantage that Home Assistant automaticaly finds all devices on restart.</p>"},{"location":"firmware/configuration/mqtt_settings/#enable-expiration","title":"Enable Expiration","text":"<p>When enabled, values in Home Assistant will become \"unavailable\" if they don't receive an update in a given time.</p>"},{"location":"firmware/configuration/mqtt_settings/#individual-panels","title":"Individual Panels","text":"<p>When enabled, the data each individual panel will be made available in Home Assistant</p> <ol> <li> <p>Last Will and Testament \u21a9</p> </li> <li> <p>Retained Messages \u21a9\u21a9</p> </li> <li> <p>CleanSession \u21a9</p> </li> </ol>"},{"location":"firmware/configuration/network_info/","title":"Network Info","text":""},{"location":"firmware/configuration/network_info/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/network_info/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/network_settings/","title":"Network Settings","text":""},{"location":"firmware/configuration/network_settings/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/network_settings/#settings-parameters","title":"Settings / Parameters","text":"<p>Note</p> <p>Some of this settings apply to the WiFi interface and the ethernet interface (if available on your board and configured). If ethernet is connected, the WiFi connection will be disabled and it's settings will be transfered to the ethernet interface (also the other way around). The ethernet interface has higher priority.</p>"},{"location":"firmware/configuration/network_settings/#wifi-configuration","title":"WiFi Configuration","text":""},{"location":"firmware/configuration/network_settings/#wifi-ssid","title":"WiFi SSID","text":"<p>The SSID<sup>1</sup> / name of your WiFi network.</p>"},{"location":"firmware/configuration/network_settings/#wifi-password","title":"WiFi Password","text":"<p>Optional password for the access point, if required.</p>"},{"location":"firmware/configuration/network_settings/#wifi-hostname","title":"WiFi Hostname","text":"<p>The host name with which OpenDTU logs on to various services (DNS server, MQTT server, mDNS). This name must be unique in the LAN<sup>2</sup>. The text <code>%06X</code> will be replaced internally by the ChipID of the ESP. This helps to keep the hostname unique. The hostname will be also used if the ESP is connected via ethernet.</p>"},{"location":"firmware/configuration/network_settings/#enable-dhcp","title":"Enable DHCP","text":"<p>If DHCP is enabled the OpenDTU will request it's network information like IP/Netmask/Gateway from e.g. your router. If you disable this function you have to enter these settings manually.</p>"},{"location":"firmware/configuration/network_settings/#static-ip-configuration","title":"Static IP Configuration","text":""},{"location":"firmware/configuration/network_settings/#ip-address","title":"IP Address","text":"<p>IP Address which is assigned to either the WiFi interface or the ethernet interface (if applicable). Format: <code>xxx.xxx.xxx.xxx</code></p>"},{"location":"firmware/configuration/network_settings/#netmask","title":"Netmask","text":"<p>The Netmask which is assigned to either the WiFi interface or the ethernet interface (if applicable). Format: <code>xxx.xxx.xxx.xxx</code>. The default value for a Class-C network (which you have most likely should be <code>255.255.255.0</code>).</p>"},{"location":"firmware/configuration/network_settings/#default-gateway","title":"Default Gateway","text":"<p>The default gateway which is assigned to either the WiFi interface or the ethernet interface (if applicable). Format: <code>xxx.xxx.xxx.xxx</code>. For a standard home network this should be the IP of your router (e.g. <code>192.168.178.1</code>).</p>"},{"location":"firmware/configuration/network_settings/#dns-server-1","title":"DNS Server 1","text":"<p>The DNS server which is assigned to either the WiFi interface or the ethernet interface (if applicable). Format: <code>xxx.xxx.xxx.xxx</code>. For a standard home network this should be the IP of your router (e.g. <code>192.168.178.1</code>).</p>"},{"location":"firmware/configuration/network_settings/#dns-server-2","title":"DNS Server 2","text":"<p>Please see DNS Server 1</p>"},{"location":"firmware/configuration/network_settings/#mdns-settings","title":"mDNS Settings","text":""},{"location":"firmware/configuration/network_settings/#enable-mdns","title":"Enable mDNS","text":"<p>Enables or disables the mDNS publication of the IP address and version the OpenDTU. This is useful to address the DTU in the network with its DNS name if no DNS server (e.g. on the router) is available. The generated mDNS name is composed as follows: <code>&lt;WiFi Hostname&gt;.local</code>.</p>"},{"location":"firmware/configuration/network_settings/#wifi-configuration-admin-accesspoint","title":"WiFi Configuration (Admin AccessPoint)","text":""},{"location":"firmware/configuration/network_settings/#accesspoint-timeout","title":"AccessPoint Timeout","text":"<p>After each device restart, if no valid WiFi configuration is found or if the configured AccessPoint is not found, an internal AccessPoint is opened. In case that the Wifi configuration is valid and the infrastrcuture AP<sup>3</sup> is reachable, the internal AP is closed after the time configured in this setting.</p> <ol> <li> <p>SSID \u21a9</p> </li> <li> <p>Local Area Network \u21a9</p> </li> <li> <p>Access Point \u21a9</p> </li> </ol>"},{"location":"firmware/configuration/ntp_info/","title":"NTP Information","text":""},{"location":"firmware/configuration/ntp_info/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/ntp_info/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/ntp_settings/","title":"NTP Settings","text":""},{"location":"firmware/configuration/ntp_settings/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/ntp_settings/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/ntp_settings/#ntp-configuration","title":"NTP Configuration","text":"<p>OpenDTU needs a proper synced clock to start fetching the inverter. (Every request contains the time. This synchronises the clock in the inverter at the same time. This is particularly important for the event display.)</p>"},{"location":"firmware/configuration/ntp_settings/#time-server","title":"Time Server","text":"<p>Hostname or IP address of your NTP<sup>1</sup> server. The default value is ok unless your WiFi does not provide access to the internet. In this case you have to enter your own NTP server (mostly the IP of your router e.g. <code>192.168.178.1</code>).</p>"},{"location":"firmware/configuration/ntp_settings/#timezone","title":"Timezone","text":"<p>Select the city or timezone you are in. NTP<sup>1</sup> deliver the current time as UTC<sup>2</sup>. The timezone is used to calculate your specific current time.</p>"},{"location":"firmware/configuration/ntp_settings/#timezone-config","title":"Timezone Config","text":"<p>This information shows how the time zone is interpreted internally. It contains information regarding offsets to UTC<sup>2</sup> and also regarding DST<sup>3</sup>.</p>"},{"location":"firmware/configuration/ntp_settings/#location-configuration","title":"Location Configuration","text":"<p>The location coordinates are required to determine the sunset and sunrise. The sunset type adds an offset to that value. This is used e.g. to stop polling the inverter at night.</p>"},{"location":"firmware/configuration/ntp_settings/#latitude","title":"Latitude","text":"<p>Latitude of the location of your inverter in degree.</p>"},{"location":"firmware/configuration/ntp_settings/#longitude","title":"Longitude","text":"<p>Longitude of the location of your inverter in degree.</p>"},{"location":"firmware/configuration/ntp_settings/#sunset-type","title":"Sunset type","text":"<p>There are differnt \"Sunset types\" which add different offsets to the calculated time. The following values are possible:</p> <ul> <li>Standard dawn (90.8\u00b0)</li> <li>Nautical dawn (102\u00b0)</li> <li>Civil dawn (96\u00b0)</li> <li>Astronomical dawn (102\u00b0)</li> </ul> <p>For some locations there might be even no sunset / sunrise because the sun shines everytime or never. See here for further explanation.</p>"},{"location":"firmware/configuration/ntp_settings/#manual-time-synchronization","title":"Manual Time Synchronization","text":""},{"location":"firmware/configuration/ntp_settings/#current-opendtu-time","title":"Current OpenDTU Time","text":"<p>Shows the current time of the ESP MCU. This value is used for all further calculations.</p>"},{"location":"firmware/configuration/ntp_settings/#current-local-time","title":"Current Local Time","text":"<p>Shows the current time detected from your web browser.</p>"},{"location":"firmware/configuration/ntp_settings/#synchronize-time","title":"Synchronize Time","text":"<p>Press this button to manually synchronize the ESP time with your local time. This can be usefull if no NTP server is available.</p> <p>Note</p> <p>Keep in mind, that the time gets lost after a power cycle. Also note, that the time accuracy will be skewed badly, as it can not resynchronised regularly using a NTP server and the ESP32 microcontroller does not have a RTC<sup>4</sup>.</p> <ol> <li> <p>Network Time Protocol \u21a9\u21a9</p> </li> <li> <p>Coordinated Universal Timeordic \u21a9\u21a9</p> </li> <li> <p>Daylight saving time \u21a9</p> </li> <li> <p>Real-time clock \u21a9</p> </li> </ol>"},{"location":"firmware/configuration/security_settings/","title":"Security Settings","text":""},{"location":"firmware/configuration/security_settings/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/security_settings/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/configuration/security_settings/#admin-password","title":"Admin password","text":""},{"location":"firmware/configuration/security_settings/#password","title":"Password","text":"<p>This password is used both to log in to the web interface and to connect to the Admin AccessPoint.</p>"},{"location":"firmware/configuration/security_settings/#repeat-password","title":"Repeat Password","text":"<p>Enter the same password as above. Just to make sure there is no typo.</p>"},{"location":"firmware/configuration/security_settings/#permissions","title":"Permissions","text":""},{"location":"firmware/configuration/security_settings/#allow-readonly-access-to-web-interface-without-password","title":"Allow readonly access to web interface without password","text":"<p>By default, any access to OpenDTU data is password restricted. If you enable this feature guest users are able to access read-only information (like Live View or System Information) without password.</p>"},{"location":"firmware/configuration/system_info/","title":"System Info","text":""},{"location":"firmware/configuration/system_info/#screenshot","title":"Screenshot","text":""},{"location":"firmware/configuration/system_info/#settings-parameters","title":"Settings / Parameters","text":""},{"location":"firmware/howto/serial_console/","title":"Access the serial console","text":"<p>The serial console which is shown in the WebUI does not show the whole boot process and also not several very critical errors. (Just because in such moments the TCP connection is also interrupted). There are several ways to look at the serial console. First of all, the ESP32 has to be connected via an USB cable to the computer.</p>"},{"location":"firmware/howto/serial_console/#windows","title":"Windows","text":"<p>If you are using Windows and installed a pre-compiled .bin file you can use e.g. Putty</p> <ul> <li>Download the putty.exe file and run it.</li> <li> <p>Select \"Connection type\" --&gt; \"Serial\", enter the correct serial port (e.g. COM3) and the right baud rate: 115200</p> <p></p> </li> <li> <p>In the section \"Session\" --&gt; \"Logging\" you can optionally configure a logging output to a file</p> </li> <li>Then press \"Open\"</li> </ul>"},{"location":"firmware/howto/serial_console/#linux","title":"Linux","text":"<p>You will see a device pop up when connecting your ESP32. It may be <code>/dev/ttyUSB0</code> (or <code>USB1</code>, <code>USB2</code>, etc.) or <code>/dev/ttyACM0</code> (or 1 or 2 etc.). If you don't see any popup, you can use <code>sudo dmesg</code> in the terminal to determine the name. Connect to it using a serial terminal. I recommend minicom for this application (<code>sudo apt install minicom</code>). This should do (in a terminal):</p> <pre><code>minicom -D /dev/ttyUSB0 -C /tmp/capture.txt -b 115200\n</code></pre> <p>You should see the output you also see in the Web console. You can also look at <code>/tmp/capture.txt</code> in parallel to make sure the messages are captured there.</p>"},{"location":"firmware/howto/serial_console/#compiled-with-vscode","title":"Compiled with VSCode","text":"<p>If you are compiling the source by yourself using VS Code you can just press the \"Serial Monitor\" button in the status bar</p> <p></p>"},{"location":"hardware/","title":"Getting Started","text":"<p>OpenDTU supports the ESP32 family of microcontrollers.</p> <p>Depending on the inverter to be addressed, different RF modules are required. The HM series requires the NRF24L01+ module, while the HMS/HMT series requires the CMT2300A module. Please see the inverter overview to see if your inverter is supported and to determine the required RF module.</p>"},{"location":"hardware/#steps-to-build-your-own-dtu","title":"Steps to build your own DTU","text":"<ol> <li>Determine the RF module you need</li> <li>Get a ESP32 module.</li> <li>Use a power suppy with 5 V and 1 A. The USB cable connected to your PC/Notebook may be powerful enough or may be not. Also the quality of the used USB cable might have an impact.</li> <li>Wire the module and RF module</li> <li>Wire a optional display</li> <li>Wire optional LEDs</li> <li>Flash the firmware via USB</li> <li>Upload a device profile which describes your hardware (or look at the profile first and connect your pins accordingly) using the Config Managment</li> </ol>"},{"location":"hardware/cmt2300a/","title":"CMT2300A Module","text":""},{"location":"hardware/cmt2300a/#technical-details","title":"Technical details","text":"Property Value Name CMT2300A Frequency 868MHz Product Info Link Datasheet Link"},{"location":"hardware/cmt2300a/#description","title":"Description","text":"<p>The CMT2300A module is a 868MHz RF module. It is important to get a module which supports SPI communication. Currently only the EBYTE E49-900M20S is supported as a standalone module, or use the OpenDTUFusion integrated PCB instead.</p> <p>The CMT2300A uses 3-Wire half duplex SPI communication. Due to this fact it currently requires a separate SPI bus. If you want to run the CMT2300A module on the same ESP32 as a NRF24L01+ module or a PCD8544 display make sure you get a ESP which supports 2 SPI busses. Currently the SPI bus host is hardcoded to number 2. This may change in future.</p> <p>Buy your hardware from a trusted source, at best from a dealer/online shop in your country where you have support and the right to return non-functional hardware. When you want to buy from Amazon, AliExpress, eBay etc., take note that there is a lot of low-quality or fake hardware offered. Read customer comments and ratings carefully!</p> <p>A heavily incomplete list of shops is:</p> <ul> <li>EBYTE E49-900M20S</li> <li>Antenna</li> <li>Blinkyparts (incl. breakout board)</li> </ul> <p>This list is for your convenience only, the project is not related to any of these shops.</p>"},{"location":"hardware/cmt2300a/#pictures","title":"Pictures","text":"<p>CMT2300a module</p>"},{"location":"hardware/cmt2300a/#pin-assignment","title":"Pin assignment","text":"<p>The connection pins from the CMT2300A module to the ESP32 module can dynamically configured using Device Profiles (prefered method) or at compile time.</p> Name in Device Profile Pin Function Description Possible name(s) on PCB sdio Digital Input/Output SPI Data Input/Output SDIO clk Digital Input SPI Clock SCLK cs Digital Input SPI register accesser CSB fcs Digital Input SPI FIFO accesser FCSB gpio2 Digital Output Interrupt pin GPIO2 gpio3 Digital Output Interrupt pin GPIO3 Power Power Supply (1,8V - 3.6V) VDD, VCC Power Ground VSS, GND"},{"location":"hardware/display/","title":"Displays","text":""},{"location":"hardware/display/#supported-models","title":"Supported Models","text":""},{"location":"hardware/display/#oled-display-ssd1306","title":"OLED Display SSD1306","text":"<ul> <li>Size: 0,96\"</li> <li>Resolution: 128x64 pixel</li> <li> <p>Supported bus: I\u00b2C</p> <p></p> </li> </ul>"},{"location":"hardware/display/#oled-display-sh1106","title":"OLED Display SH1106","text":"<ul> <li>Size: 1,3\"</li> <li>Resolution: 128x64 pixel</li> <li> <p>Supported bus: I\u00b2C</p> <p></p> </li> </ul>"},{"location":"hardware/display/#oled-display-ssd1309","title":"OLED Display SSD1309","text":"<ul> <li>Size: 2,42\"</li> <li>Resolution: 128x64 pixel</li> <li> <p>Supported bus: I\u00b2C</p> <p></p> </li> </ul>"},{"location":"hardware/display/#lcd-display-pcd8544","title":"LCD Display PCD8544","text":"<ul> <li>Size: 2,7\"</li> <li>Resolution: 84x48 pixel</li> <li> <p>Supported bus: SPI</p> <p></p> </li> </ul>"},{"location":"hardware/esp32nodemcu_38pin/","title":"ESP32 NodeMCU 38 pin","text":"<p>To use this board please refere to the Device Profile called <code>nodemcu_esp32.json</code> or <code>blinkyparts_esp32.json</code>. Both are nicely compatible with the dev board. Open the JSON file with a text editor and have a look at the specific pin numbers.</p>"},{"location":"hardware/esp32nodemcu_38pin/#schematic","title":"Schematic","text":""},{"location":"hardware/esp32nodemcu_38pin/#symbolic-view","title":"Symbolic View","text":""},{"location":"hardware/inverter_overview/","title":"Inverter Overview","text":"<p>TSUN compatibility remark</p> <p>Compatibility with OpenDTU is most likly related to the serial number of the inverter. Current findings indicate that TSUN inverters with a serial number starting with \"11\" are supported, whereby inverters with a serial number starting with \"10\" are not.</p> <p>Hoymiles HMS-xxxx-xT-NA compatibility remark</p> <p>Currently it seems not to be possible to change the communication frequency of the \"-NA\" inverters. Please set the communication freuqency to 915MHz to get these inverters working.</p> Model Required RF Module DC Inputs MPP-Tracker AC Phases Hoymiles HM-300-1T NRF24L01+ 1 1 1 Hoymiles HM-350-1T NRF24L01+ 1 1 1 Hoymiles HM-400-1T NRF24L01+ 1 1 1 Hoymiles HM-600-2T NRF24L01+ 2 2 1 Hoymiles HM-700-2T NRF24L01+ 2 2 1 Hoymiles HM-800-2T NRF24L01+ 2 2 1 Hoymiles HM-1000-4T NRF24L01+ 4 2 1 Hoymiles HM-1200-4T NRF24L01+ 4 2 1 Hoymiles HM-1500-4T NRF24L01+ 4 2 1 Hoymiles HMS-300-1T CMT2300A 1 1 1 Hoymiles HMS-350-1T CMT2300A 1 1 1 Hoymiles HMS-400-1T CMT2300A 1 1 1 Hoymiles HMS-450-1T CMT2300A 1 1 1 Hoymiles HMS-500-1T CMT2300A 1 1 1 Hoymiles HMS-600-2T CMT2300A 2 2 1 Hoymiles HMS-700-2T CMT2300A 2 2 1 Hoymiles HMS-800-2T CMT2300A 2 2 1 Hoymiles HMS-900-2T CMT2300A 2 2 1 Hoymiles HMS-1000-2T CMT2300A 2 2 1 Hoymiles HMS-1600-4T CMT2300A 4 4 1 Hoymiles HMS-1800-4T CMT2300A 4 4 1 Hoymiles HMS-2000-4T CMT2300A 4 4 1 Hoymiles HMT-1600-4T CMT2300A 4 2 3 Hoymiles HMT-1800-4T CMT2300A 4 2 3 Hoymiles HMT-2000-4T CMT2300A 4 2 3 Hoymiles HMT-1800-6T CMT2300A 6 3 3 Hoymiles HMT-2250-6T CMT2300A 6 3 3 Solenso SOL-H350 NRF24L01+ 1 1 1 Solenso SOL-H400 NRF24L01+ 1 1 1 Solenso SOL-H800 NRF24L01+ 2 2 1 TSUN TSOL-M350 NRF24L01+ 1 1 1 TSUN TSOL-M800 NRF24L01+ 2 2 1 TSUN TSOL-M1600 NRF24L01+ 4 2 1"},{"location":"hardware/led/","title":"LEDs","text":""},{"location":"hardware/nrf24l01plus/","title":"NRF24L01 Module","text":""},{"location":"hardware/nrf24l01plus/#technical-details","title":"Technical details","text":"Property Value Name nRF24L01+ Frequency 2.4GHz Datasheet Link"},{"location":"hardware/nrf24l01plus/#description","title":"Description","text":"<p>The NRF24L01+ module is a 2,4GHz RF module. It is absolutly important to get the newer PLUS variant! (Only the PLUS variant supports the required transmission speeds and is able to communicate with the inverter) There are several variants with different qualities and prices. Most of them are pin compatible. A noteable brand name is e.g. EBYTE ML01DP5. It includes a proper shielding and integrated capacitors.</p> <p>Buy your hardware from a trusted source, at best from a dealer/online shop in your country where you have support and the right to return non-functional hardware. When you want to buy from Amazon, AliExpress, eBay etc., take note that there is a lot of low-quality or fake hardware offered. Read customer comments and ratings carefully!</p> <p>A heavily incomplete list of trusted hardware shops in germany is:</p> <ul> <li>AZ-Delivery</li> <li>Makershop</li> <li>Berrybase</li> </ul> <p>This list is for your convenience only, the project is not related to any of these shops.</p>"},{"location":"hardware/nrf24l01plus/#pictures","title":"Pictures","text":"<p>EBYTE ML01DP5 module</p> <p> </p> <p>Generic nRF24L01+ Module with PCB antenna</p> <p> </p> <p>Generic nRF24L01+ Module with SMA antenna</p>"},{"location":"hardware/nrf24l01plus/#pin-assignment","title":"Pin assignment","text":"<p>The connection pins from the nRF24L01+ module to the ESP32 module can dynamically configured using Device Profiles (prefered method) or at compile time.</p> Name in Device Profile Pin Function Description Possible name(s) on PCB miso Digital Output SPI Slave Data Output MISO mosi Digital Input SPI Slave Data Input MOSI clk Digital Input SPI Clock CLK, SCK irq Digital Output Interrupt pin IRQ en Digital Input Chip Enable EN, CE cs Digital Input SPI Chip Select CS, CSN Power Power Supply (1,9V - 3.6V) VDD, VCC Power Ground VSS, GND"},{"location":"hardware/olimexpoeiso/","title":"Olimex ESP32-POE-ISO","text":"<p>To use this board please refere to the Device Profile called <code>olimex_esp32_poe.json</code>. Depending on the features (LEDs) or display type you need you can easily adjust the existing config. Open the JSON file with a text editor and have a look at the specific pin numbers.</p>"},{"location":"hardware/olimexpoeiso/#schematic","title":"Schematic","text":""},{"location":"hardware/olimexpoeiso/#symbolic-view","title":"Symbolic View","text":""}]}